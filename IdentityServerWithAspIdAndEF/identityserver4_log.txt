2018-05-27 17:54:06.659 +03:00 [WRN] No XML encryptor configured. Key "e64c44ac-43d9-4e59-9a59-60834f3e46a8" may be persisted to storage in unencrypted form.
2018-05-27 17:54:07.136 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-05-27 17:54:07.146 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-05-27 17:54:07.151 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-05-27 17:54:07.155 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-05-27 17:54:07.158 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-05-27 17:54:07.551 +03:00 [DBG] Starting token cleanup
2018-05-27 17:54:08.535 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:08.581 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:16.429 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:16.444 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:16.464 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-05-27 17:54:16.484 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-05-27 17:54:16.490 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-05-27 17:54:16.506 +03:00 [DBG] Start authorize request
2018-05-27 17:54:16.516 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:16.527 +03:00 [DBG] No user present in authorize request
2018-05-27 17:54:16.558 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:54:19.285 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:54:19.565 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:20.330 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:20.458 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:20.662 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:20.714 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:54:20.867 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15274328564150.6240613308742335",
  "Nonce": "N0.53324664589974581527432856415",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.53324664589974581527432856415",
    "state": "15274328564150.6240613308742335"
  }
}
2018-05-27 17:54:20.901 +03:00 [INF] Showing login: User is not authenticated
2018-05-27 17:54:20.930 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:20.937 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:21.150 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:21.156 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:54:21.877 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:54:22.000 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:22.298 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:22.416 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:22.708 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:22.716 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:54:23.381 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:54:24.914 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {1a311229-87f0-43d4-a5d1-6d1d3418f14e} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-05-27 17:54:26.986 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:26.991 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:27.065 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-05-27 17:54:33.140 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-05-27 17:54:33.186 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:33.196 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:33.297 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-05-27 17:54:34.223 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLE3S6P9O2EB:0000000A",
  "TimeStamp": "2018-05-27T14:54:34Z",
  "ProcessId": 46480,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-05-27 17:54:34.253 +03:00 [DBG] Augmenting SignInContext
2018-05-27 17:54:34.261 +03:00 [DBG] Adding amr claim with value: external
2018-05-27 17:54:34.270 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:34.280 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-05-27 17:54:34.297 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-05-27 17:54:34.337 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:54:34.346 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:54:34.357 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-05-27 17:54:34.368 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-05-27 17:54:34.375 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-05-27 17:54:34.397 +03:00 [DBG] Start authorize callback request
2018-05-27 17:54:34.411 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-05-27 17:54:34.417 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:54:35.639 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:54:35.864 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:36.501 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:36.798 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:37.414 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:37.421 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:54:37.426 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15274328564150.6240613308742335",
  "Nonce": "N0.53324664589974581527432856415",
  "SessionId": "f3d02a5ab520183a7583005964ec6ce8",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.53324664589974581527432856415",
    "state": "15274328564150.6240613308742335"
  }
}
2018-05-27 17:54:37.785 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-05-27 17:54:37.844 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-05-27 17:54:37.865 +03:00 [DBG] Creating Implicit Flow response.
2018-05-27 17:54:37.887 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-05-27 17:54:37.891 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-05-27 17:54:38.175 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-05-27 17:54:38.361 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****vZvg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****VlXg"
    }
  ],
  "ActivityId": "0HLE3S6P9O2EB:0000000B",
  "TimeStamp": "2018-05-27T14:54:38Z",
  "ProcessId": 46480,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-05-27 17:54:38.380 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15274328564150.6240613308742335",
  "Scope": "openid profile dews.api"
}
2018-05-27 17:54:38.438 +03:00 [DBG] Augmenting SignInContext
2018-05-27 17:54:38.442 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-05-27 17:54:41.090 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-05-27 17:54:41.158 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-05-27 17:54:41.163 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-05-27 17:54:41.172 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-05-27 17:54:41.182 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-05-27 17:54:41.186 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-05-27 17:54:41.195 +03:00 [DBG] Start key discovery request
2018-05-27 17:56:05.551 +03:00 [WRN] No XML encryptor configured. Key "52a3938c-3541-4da7-ac74-134bec9aac7a" may be persisted to storage in unencrypted form.
2018-05-27 17:56:05.993 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-05-27 17:56:06.006 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-05-27 17:56:06.009 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-05-27 17:56:06.013 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-05-27 17:56:06.016 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-05-27 17:56:06.333 +03:00 [DBG] Starting token cleanup
2018-05-27 17:56:07.652 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:07.698 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:24.105 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:24.115 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:24.141 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-05-27 17:56:24.161 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-05-27 17:56:24.167 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-05-27 17:56:24.188 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:24.192 +03:00 [DBG] Processing signout request for anonymous
2018-05-27 17:56:24.221 +03:00 [DBG] Start end session request validation
2018-05-27 17:56:24.246 +03:00 [DBG] Start identity token validation
2018-05-27 17:56:27.043 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:27.048 +03:00 [DBG] Client found: dews.web / Developer News
2018-05-27 17:56:27.425 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-05-27 17:56:27.484 +03:00 [DBG] Token validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "ValidateLifetime": false,
  "Claims": {
    "nbf": 1527432878,
    "exp": 1527433178,
    "iss": "http://localhost:5000",
    "aud": "dews.web",
    "nonce": "N0.53324664589974581527432856415",
    "iat": 1527432878,
    "at_hash": "8ZpQvsxIQXhSknbIJNbo4g",
    "sid": "f3d02a5ab520183a7583005964ec6ce8",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1527432874,
    "idp": "Google",
    "name": "MURAT AKKAÅž",
    "preferred_username": "4405b296-a304-436e-ad3f-739afefa4931",
    "amr": "external"
  }
}
2018-05-27 17:56:27.521 +03:00 [INF] End session request validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "SubjectId": "unknown",
  "PostLogOutUri": "http://localhost:4200",
  "Raw": {
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ4YjhlNTE4ODNkMjc0NGJkZGQxNzdkZTRmZGE4Yjk1IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1Mjc0MzI4NzgsImV4cCI6MTUyNzQzMzE3OCwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoiZGV3cy53ZWIiLCJub25jZSI6Ik4wLjUzMzI0NjY0NTg5OTc0NTgxNTI3NDMyODU2NDE1IiwiaWF0IjoxNTI3NDMyODc4LCJhdF9oYXNoIjoiOFpwUXZzeElRWGhTa25iSUpOYm80ZyIsInNpZCI6ImYzZDAyYTVhYjUyMDE4M2E3NTgzMDA1OTY0ZWM2Y2U4Iiwic3ViIjoiYzVlMzcwZTYtNzIxOC00OWQ4LWE1MjAtOTg3ZTYzNjk3ZDQzIiwiYXV0aF90aW1lIjoxNTI3NDMyODc0LCJpZHAiOiJHb29nbGUiLCJuYW1lIjoiTVVSQVQgQUtLQcWeIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNDQwNWIyOTYtYTMwNC00MzZlLWFkM2YtNzM5YWZlZmE0OTMxIiwiYW1yIjpbImV4dGVybmFsIl19.fzC82fiw6ukS-WtlMyTdSVPtNC3o8cSKBN78w3K13eky0CQ7kwkcFPW0-t6FoTW_Yl7cIz55Ba3G-yg3TxYRpUffluBvgw4TvHp7uYCvHqlWpIYrtTmox_xti_80KIHqWJkbR6-krpCfjBJENLYxc8yHD9A4DDEnAV5A9fIizpvQ5D7sJSNJDuxkYhpzGQMrFPRdTgmpJKHIelXIWH14XW3e_Y02A-okNYlQRuB9VwhtTpFYALhP-tHh5tpTkYazujIJcX9qYbyGxlXEpvuLZp9sz-qQ3YCehRpOy0R_YdRJRGB9QBQy-iRUadSY3nb-r7dTnRu--Vn3HZuvFrvZvg",
    "post_logout_redirect_uri": "http://localhost:4200"
  }
}
2018-05-27 17:56:27.534 +03:00 [DBG] Success validating end session request from dews.web
2018-05-27 17:56:27.700 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:27.705 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:28.053 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:36.936 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:36.944 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:36.949 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-05-27 17:56:36.958 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-05-27 17:56:36.963 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-05-27 17:56:36.979 +03:00 [DBG] Start authorize request
2018-05-27 17:56:36.983 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:36.995 +03:00 [DBG] No user present in authorize request
2018-05-27 17:56:37.018 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:56:37.520 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:37.764 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:38.497 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:38.637 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:38.905 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:38.936 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:56:38.970 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15274328564150.6240613308742335",
  "Nonce": "N0.078584545689058371527432996925",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.078584545689058371527432996925",
    "state": "15274328564150.6240613308742335"
  }
}
2018-05-27 17:56:39.002 +03:00 [INF] Showing login: User is not authenticated
2018-05-27 17:56:39.032 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:39.040 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:39.146 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:39.153 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:56:39.899 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:40.053 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:40.411 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:40.545 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:40.887 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:40.893 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:56:41.537 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:42.879 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {e64c44ac-43d9-4e59-9a59-60834f3e46a8} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-05-27 17:56:45.583 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:45.589 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:45.669 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-05-27 17:56:50.252 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-05-27 17:56:50.270 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:50.274 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:50.361 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-05-27 17:56:51.135 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLE3S7SOACHJ:00000009",
  "TimeStamp": "2018-05-27T14:56:51Z",
  "ProcessId": 49356,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-05-27 17:56:51.172 +03:00 [DBG] Augmenting SignInContext
2018-05-27 17:56:51.185 +03:00 [DBG] Adding amr claim with value: external
2018-05-27 17:56:51.194 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:51.205 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-05-27 17:56:51.233 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-05-27 17:56:51.271 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:56:51.276 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:56:51.282 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-05-27 17:56:51.287 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-05-27 17:56:51.291 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-05-27 17:56:51.308 +03:00 [DBG] Start authorize callback request
2018-05-27 17:56:51.319 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-05-27 17:56:51.326 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:56:51.765 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:51.872 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:52.150 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:52.272 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:52.506 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:52.514 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:56:52.519 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15274328564150.6240613308742335",
  "Nonce": "N0.078584545689058371527432996925",
  "SessionId": "f4c95383706ca83fe473fd981d94394c",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.078584545689058371527432996925",
    "state": "15274328564150.6240613308742335"
  }
}
2018-05-27 17:56:52.726 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-05-27 17:56:52.755 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-05-27 17:56:52.782 +03:00 [DBG] Creating Implicit Flow response.
2018-05-27 17:56:52.811 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-05-27 17:56:52.816 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-05-27 17:56:53.077 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-05-27 17:56:53.294 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****g1Mg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****ibgg"
    }
  ],
  "ActivityId": "0HLE3S7SOACHJ:0000000A",
  "TimeStamp": "2018-05-27T14:56:53Z",
  "ProcessId": 49356,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-05-27 17:56:53.322 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15274328564150.6240613308742335",
  "Scope": "openid profile dews.api"
}
2018-05-27 17:56:53.368 +03:00 [DBG] Augmenting SignInContext
2018-05-27 17:56:53.373 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-05-27 17:56:55.964 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-05-27 17:56:56.030 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-05-27 17:56:56.034 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-05-27 17:56:56.047 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-05-27 17:56:56.059 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-05-27 17:56:56.064 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-05-27 17:56:56.076 +03:00 [DBG] Start key discovery request
2018-05-27 17:56:56.307 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-05-27 17:56:56.348 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-05-27 17:56:56.352 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-05-27 17:56:56.360 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-05-27 17:56:56.367 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-05-27 17:56:56.372 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-05-27 17:56:56.385 +03:00 [DBG] Start userinfo request
2018-05-27 17:56:56.394 +03:00 [DBG] Bearer token found in header
2018-05-27 17:56:56.831 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:57.313 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:57.386 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-05-27 17:56:57.397 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1527433013,
    "exp": 1527436613,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1527433011,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-05-27 17:56:57.423 +03:00 [DBG] Creating userinfo response
2018-05-27 17:56:57.434 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-05-27 17:56:57.444 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-05-27 17:56:57.542 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:57.556 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-05-27 17:56:57.561 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-05-27 17:56:57.625 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:57.746 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-05-27 17:56:57.751 +03:00 [DBG] End userinfo request
2018-05-27 17:56:59.342 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:56:59.348 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:56:59.354 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-05-27 17:56:59.360 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-05-27 17:56:59.364 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-05-27 17:56:59.375 +03:00 [DBG] Processing signout request for c5e370e6-7218-49d8-a520-987e63697d43
2018-05-27 17:56:59.382 +03:00 [DBG] Start end session request validation
2018-05-27 17:56:59.388 +03:00 [DBG] Start identity token validation
2018-05-27 17:56:59.857 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:59.862 +03:00 [DBG] Client found: dews.web / Developer News
2018-05-27 17:56:59.944 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-05-27 17:56:59.949 +03:00 [DBG] Token validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "ValidateLifetime": false,
  "Claims": {
    "nbf": 1527433013,
    "exp": 1527433313,
    "iss": "http://localhost:5000",
    "aud": "dews.web",
    "nonce": "N0.078584545689058371527432996925",
    "iat": 1527433013,
    "at_hash": "dz4sHHezfFQAsoE8vk3zNA",
    "sid": "f4c95383706ca83fe473fd981d94394c",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1527433011,
    "idp": "Google",
    "name": "MURAT AKKAÅž",
    "preferred_username": "4405b296-a304-436e-ad3f-739afefa4931",
    "amr": "external"
  }
}
2018-05-27 17:56:59.959 +03:00 [INF] End session request validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "PostLogOutUri": "http://localhost:4200",
  "Raw": {
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ4YjhlNTE4ODNkMjc0NGJkZGQxNzdkZTRmZGE4Yjk1IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1Mjc0MzMwMTMsImV4cCI6MTUyNzQzMzMxMywiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoiZGV3cy53ZWIiLCJub25jZSI6Ik4wLjA3ODU4NDU0NTY4OTA1ODM3MTUyNzQzMjk5NjkyNSIsImlhdCI6MTUyNzQzMzAxMywiYXRfaGFzaCI6ImR6NHNISGV6ZkZRQXNvRTh2azN6TkEiLCJzaWQiOiJmNGM5NTM4MzcwNmNhODNmZTQ3M2ZkOTgxZDk0Mzk0YyIsInN1YiI6ImM1ZTM3MGU2LTcyMTgtNDlkOC1hNTIwLTk4N2U2MzY5N2Q0MyIsImF1dGhfdGltZSI6MTUyNzQzMzAxMSwiaWRwIjoiR29vZ2xlIiwibmFtZSI6Ik1VUkFUIEFLS0HFniIsInByZWZlcnJlZF91c2VybmFtZSI6IjQ0MDViMjk2LWEzMDQtNDM2ZS1hZDNmLTczOWFmZWZhNDkzMSIsImFtciI6WyJleHRlcm5hbCJdfQ.FpFox6otCaHeoITopGCc8xDg2HOJq9mFytqSI7JcrY87z3dGSX7YlxjEFXyIzFH9Wii1Di1bD7eDwmp-8EFad05_9E6KRN5KOSShogjnPraTEJ6blsX52vaMxSYJnfoywZmbyvC3HiRdzkNpvOnhRJLGTIxtlRrMItIdkBbofzLxNGUIkRD4x5YB8il8ahEJAyEx223VJGyw3qz-g-1fZbbvcJl4sE2U0h5nZ3wHwRFJvrGGWHvp3vXwW1XpyCCOqSGFTmtS5KNXVkDiYgKzZkmihjuAT7M2yhTKcElQh2yzIfVRNmtn9i5fHcnasp_UUcyOpjJ12NPiXJUPNCg1Mg",
    "post_logout_redirect_uri": "http://localhost:4200"
  }
}
2018-05-27 17:56:59.966 +03:00 [DBG] Success validating end session request from dews.web
2018-05-27 17:56:59.982 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:56:59.990 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:57:00.126 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-05-27 17:57:00.155 +03:00 [INF] {
  "Name": "User Logout Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1002,
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "ActivityId": "0HLE3S7SOACHJ:0000000C",
  "TimeStamp": "2018-05-27T14:57:00Z",
  "ProcessId": 49356,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-05-27 17:57:00.173 +03:00 [INF] AuthenticationScheme: Identity.Application signed out.
2018-05-27 17:57:00.182 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-05-27 17:57:00.190 +03:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2018-05-27 17:57:00.299 +03:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2018-05-27 17:57:00.309 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2018-05-27 17:57:00.313 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2018-05-27 17:57:00.328 +03:00 [DBG] Processing signout callback request
2018-05-27 17:57:00.813 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:57:00.818 +03:00 [DBG] No client front-channel logout URLs
2018-05-27 17:57:00.825 +03:00 [DBG] No client back-channel logout URLs
2018-05-27 17:57:00.829 +03:00 [INF] Successful signout callback.
2018-05-27 17:57:00.836 +03:00 [DBG] No client front-channel iframe urls
2018-05-27 17:57:00.842 +03:00 [DBG] No client back-channel iframe urls
2018-05-27 19:19:30.014 +03:00 [WRN] No XML encryptor configured. Key "87576612-1ef9-4fff-b13c-d2a5765ee6a1" may be persisted to storage in unencrypted form.
2018-05-27 19:19:30.381 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-05-27 19:19:30.390 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-05-27 19:19:30.393 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-05-27 19:19:30.398 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-05-27 19:19:30.401 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-05-27 19:19:30.673 +03:00 [DBG] Starting token cleanup
2018-05-27 19:21:10.710 +03:00 [WRN] No XML encryptor configured. Key "ab9e91e4-0749-4505-9baf-139f58947b4d" may be persisted to storage in unencrypted form.
2018-05-27 19:21:10.996 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-05-27 19:21:11.004 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-05-27 19:21:11.006 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-05-27 19:21:11.011 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-05-27 19:21:11.019 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-05-27 19:21:11.205 +03:00 [DBG] Starting token cleanup
