2018-05-27 17:54:06.659 +03:00 [WRN] No XML encryptor configured. Key "e64c44ac-43d9-4e59-9a59-60834f3e46a8" may be persisted to storage in unencrypted form.
2018-05-27 17:54:07.136 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-05-27 17:54:07.146 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-05-27 17:54:07.151 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-05-27 17:54:07.155 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-05-27 17:54:07.158 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-05-27 17:54:07.551 +03:00 [DBG] Starting token cleanup
2018-05-27 17:54:08.535 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:08.581 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:16.429 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:16.444 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:16.464 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-05-27 17:54:16.484 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-05-27 17:54:16.490 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-05-27 17:54:16.506 +03:00 [DBG] Start authorize request
2018-05-27 17:54:16.516 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:16.527 +03:00 [DBG] No user present in authorize request
2018-05-27 17:54:16.558 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:54:19.285 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:54:19.565 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:20.330 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:20.458 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:20.662 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:20.714 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:54:20.867 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15274328564150.6240613308742335",
  "Nonce": "N0.53324664589974581527432856415",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.53324664589974581527432856415",
    "state": "15274328564150.6240613308742335"
  }
}
2018-05-27 17:54:20.901 +03:00 [INF] Showing login: User is not authenticated
2018-05-27 17:54:20.930 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:20.937 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:21.150 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:21.156 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:54:21.877 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:54:22.000 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:22.298 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:22.416 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:22.708 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:22.716 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:54:23.381 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:54:24.914 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {1a311229-87f0-43d4-a5d1-6d1d3418f14e} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-05-27 17:54:26.986 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:26.991 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:27.065 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-05-27 17:54:33.140 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-05-27 17:54:33.186 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:33.196 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:33.297 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-05-27 17:54:34.223 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLE3S6P9O2EB:0000000A",
  "TimeStamp": "2018-05-27T14:54:34Z",
  "ProcessId": 46480,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-05-27 17:54:34.253 +03:00 [DBG] Augmenting SignInContext
2018-05-27 17:54:34.261 +03:00 [DBG] Adding amr claim with value: external
2018-05-27 17:54:34.270 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:54:34.280 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-05-27 17:54:34.297 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-05-27 17:54:34.337 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:54:34.346 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:54:34.357 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-05-27 17:54:34.368 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-05-27 17:54:34.375 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-05-27 17:54:34.397 +03:00 [DBG] Start authorize callback request
2018-05-27 17:54:34.411 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-05-27 17:54:34.417 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:54:35.639 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:54:35.864 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:36.501 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:36.798 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:54:37.414 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:54:37.421 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:54:37.426 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15274328564150.6240613308742335",
  "Nonce": "N0.53324664589974581527432856415",
  "SessionId": "f3d02a5ab520183a7583005964ec6ce8",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.53324664589974581527432856415",
    "state": "15274328564150.6240613308742335"
  }
}
2018-05-27 17:54:37.785 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-05-27 17:54:37.844 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-05-27 17:54:37.865 +03:00 [DBG] Creating Implicit Flow response.
2018-05-27 17:54:37.887 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-05-27 17:54:37.891 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-05-27 17:54:38.175 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-05-27 17:54:38.361 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****vZvg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****VlXg"
    }
  ],
  "ActivityId": "0HLE3S6P9O2EB:0000000B",
  "TimeStamp": "2018-05-27T14:54:38Z",
  "ProcessId": 46480,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-05-27 17:54:38.380 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15274328564150.6240613308742335",
  "Scope": "openid profile dews.api"
}
2018-05-27 17:54:38.438 +03:00 [DBG] Augmenting SignInContext
2018-05-27 17:54:38.442 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-05-27 17:54:41.090 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-05-27 17:54:41.158 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-05-27 17:54:41.163 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-05-27 17:54:41.172 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-05-27 17:54:41.182 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-05-27 17:54:41.186 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-05-27 17:54:41.195 +03:00 [DBG] Start key discovery request
2018-05-27 17:56:05.551 +03:00 [WRN] No XML encryptor configured. Key "52a3938c-3541-4da7-ac74-134bec9aac7a" may be persisted to storage in unencrypted form.
2018-05-27 17:56:05.993 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-05-27 17:56:06.006 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-05-27 17:56:06.009 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-05-27 17:56:06.013 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-05-27 17:56:06.016 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-05-27 17:56:06.333 +03:00 [DBG] Starting token cleanup
2018-05-27 17:56:07.652 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:07.698 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:24.105 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:24.115 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:24.141 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-05-27 17:56:24.161 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-05-27 17:56:24.167 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-05-27 17:56:24.188 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:24.192 +03:00 [DBG] Processing signout request for anonymous
2018-05-27 17:56:24.221 +03:00 [DBG] Start end session request validation
2018-05-27 17:56:24.246 +03:00 [DBG] Start identity token validation
2018-05-27 17:56:27.043 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:27.048 +03:00 [DBG] Client found: dews.web / Developer News
2018-05-27 17:56:27.425 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-05-27 17:56:27.484 +03:00 [DBG] Token validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "ValidateLifetime": false,
  "Claims": {
    "nbf": 1527432878,
    "exp": 1527433178,
    "iss": "http://localhost:5000",
    "aud": "dews.web",
    "nonce": "N0.53324664589974581527432856415",
    "iat": 1527432878,
    "at_hash": "8ZpQvsxIQXhSknbIJNbo4g",
    "sid": "f3d02a5ab520183a7583005964ec6ce8",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1527432874,
    "idp": "Google",
    "name": "MURAT AKKAÅž",
    "preferred_username": "4405b296-a304-436e-ad3f-739afefa4931",
    "amr": "external"
  }
}
2018-05-27 17:56:27.521 +03:00 [INF] End session request validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "SubjectId": "unknown",
  "PostLogOutUri": "http://localhost:4200",
  "Raw": {
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ4YjhlNTE4ODNkMjc0NGJkZGQxNzdkZTRmZGE4Yjk1IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1Mjc0MzI4NzgsImV4cCI6MTUyNzQzMzE3OCwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoiZGV3cy53ZWIiLCJub25jZSI6Ik4wLjUzMzI0NjY0NTg5OTc0NTgxNTI3NDMyODU2NDE1IiwiaWF0IjoxNTI3NDMyODc4LCJhdF9oYXNoIjoiOFpwUXZzeElRWGhTa25iSUpOYm80ZyIsInNpZCI6ImYzZDAyYTVhYjUyMDE4M2E3NTgzMDA1OTY0ZWM2Y2U4Iiwic3ViIjoiYzVlMzcwZTYtNzIxOC00OWQ4LWE1MjAtOTg3ZTYzNjk3ZDQzIiwiYXV0aF90aW1lIjoxNTI3NDMyODc0LCJpZHAiOiJHb29nbGUiLCJuYW1lIjoiTVVSQVQgQUtLQcWeIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNDQwNWIyOTYtYTMwNC00MzZlLWFkM2YtNzM5YWZlZmE0OTMxIiwiYW1yIjpbImV4dGVybmFsIl19.fzC82fiw6ukS-WtlMyTdSVPtNC3o8cSKBN78w3K13eky0CQ7kwkcFPW0-t6FoTW_Yl7cIz55Ba3G-yg3TxYRpUffluBvgw4TvHp7uYCvHqlWpIYrtTmox_xti_80KIHqWJkbR6-krpCfjBJENLYxc8yHD9A4DDEnAV5A9fIizpvQ5D7sJSNJDuxkYhpzGQMrFPRdTgmpJKHIelXIWH14XW3e_Y02A-okNYlQRuB9VwhtTpFYALhP-tHh5tpTkYazujIJcX9qYbyGxlXEpvuLZp9sz-qQ3YCehRpOy0R_YdRJRGB9QBQy-iRUadSY3nb-r7dTnRu--Vn3HZuvFrvZvg",
    "post_logout_redirect_uri": "http://localhost:4200"
  }
}
2018-05-27 17:56:27.534 +03:00 [DBG] Success validating end session request from dews.web
2018-05-27 17:56:27.700 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:27.705 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:28.053 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:36.936 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:36.944 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:36.949 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-05-27 17:56:36.958 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-05-27 17:56:36.963 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-05-27 17:56:36.979 +03:00 [DBG] Start authorize request
2018-05-27 17:56:36.983 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:36.995 +03:00 [DBG] No user present in authorize request
2018-05-27 17:56:37.018 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:56:37.520 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:37.764 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:38.497 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:38.637 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:38.905 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:38.936 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:56:38.970 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15274328564150.6240613308742335",
  "Nonce": "N0.078584545689058371527432996925",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.078584545689058371527432996925",
    "state": "15274328564150.6240613308742335"
  }
}
2018-05-27 17:56:39.002 +03:00 [INF] Showing login: User is not authenticated
2018-05-27 17:56:39.032 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:39.040 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:39.146 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:39.153 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:56:39.899 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:40.053 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:40.411 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:40.545 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:40.887 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:40.893 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:56:41.537 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:42.879 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {e64c44ac-43d9-4e59-9a59-60834f3e46a8} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-05-27 17:56:45.583 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:45.589 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:45.669 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-05-27 17:56:50.252 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-05-27 17:56:50.270 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:50.274 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:50.361 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-05-27 17:56:51.135 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLE3S7SOACHJ:00000009",
  "TimeStamp": "2018-05-27T14:56:51Z",
  "ProcessId": 49356,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-05-27 17:56:51.172 +03:00 [DBG] Augmenting SignInContext
2018-05-27 17:56:51.185 +03:00 [DBG] Adding amr claim with value: external
2018-05-27 17:56:51.194 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-05-27 17:56:51.205 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-05-27 17:56:51.233 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-05-27 17:56:51.271 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:56:51.276 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:56:51.282 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-05-27 17:56:51.287 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-05-27 17:56:51.291 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-05-27 17:56:51.308 +03:00 [DBG] Start authorize callback request
2018-05-27 17:56:51.319 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-05-27 17:56:51.326 +03:00 [DBG] Start authorize request protocol validation
2018-05-27 17:56:51.765 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:51.872 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:52.150 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:52.272 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:52.506 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-05-27 17:56:52.514 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-05-27 17:56:52.519 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15274328564150.6240613308742335",
  "Nonce": "N0.078584545689058371527432996925",
  "SessionId": "f4c95383706ca83fe473fd981d94394c",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.078584545689058371527432996925",
    "state": "15274328564150.6240613308742335"
  }
}
2018-05-27 17:56:52.726 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-05-27 17:56:52.755 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-05-27 17:56:52.782 +03:00 [DBG] Creating Implicit Flow response.
2018-05-27 17:56:52.811 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-05-27 17:56:52.816 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-05-27 17:56:53.077 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-05-27 17:56:53.294 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****g1Mg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****ibgg"
    }
  ],
  "ActivityId": "0HLE3S7SOACHJ:0000000A",
  "TimeStamp": "2018-05-27T14:56:53Z",
  "ProcessId": 49356,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-05-27 17:56:53.322 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15274328564150.6240613308742335",
  "Scope": "openid profile dews.api"
}
2018-05-27 17:56:53.368 +03:00 [DBG] Augmenting SignInContext
2018-05-27 17:56:53.373 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-05-27 17:56:55.964 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-05-27 17:56:56.030 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-05-27 17:56:56.034 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-05-27 17:56:56.047 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-05-27 17:56:56.059 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-05-27 17:56:56.064 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-05-27 17:56:56.076 +03:00 [DBG] Start key discovery request
2018-05-27 17:56:56.307 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-05-27 17:56:56.348 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-05-27 17:56:56.352 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-05-27 17:56:56.360 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-05-27 17:56:56.367 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-05-27 17:56:56.372 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-05-27 17:56:56.385 +03:00 [DBG] Start userinfo request
2018-05-27 17:56:56.394 +03:00 [DBG] Bearer token found in header
2018-05-27 17:56:56.831 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:57.313 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:57.386 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-05-27 17:56:57.397 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1527433013,
    "exp": 1527436613,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1527433011,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-05-27 17:56:57.423 +03:00 [DBG] Creating userinfo response
2018-05-27 17:56:57.434 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-05-27 17:56:57.444 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-05-27 17:56:57.542 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:57.556 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-05-27 17:56:57.561 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-05-27 17:56:57.625 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-05-27 17:56:57.746 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-05-27 17:56:57.751 +03:00 [DBG] End userinfo request
2018-05-27 17:56:59.342 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:56:59.348 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:56:59.354 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-05-27 17:56:59.360 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-05-27 17:56:59.364 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-05-27 17:56:59.375 +03:00 [DBG] Processing signout request for c5e370e6-7218-49d8-a520-987e63697d43
2018-05-27 17:56:59.382 +03:00 [DBG] Start end session request validation
2018-05-27 17:56:59.388 +03:00 [DBG] Start identity token validation
2018-05-27 17:56:59.857 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:56:59.862 +03:00 [DBG] Client found: dews.web / Developer News
2018-05-27 17:56:59.944 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-05-27 17:56:59.949 +03:00 [DBG] Token validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "ValidateLifetime": false,
  "Claims": {
    "nbf": 1527433013,
    "exp": 1527433313,
    "iss": "http://localhost:5000",
    "aud": "dews.web",
    "nonce": "N0.078584545689058371527432996925",
    "iat": 1527433013,
    "at_hash": "dz4sHHezfFQAsoE8vk3zNA",
    "sid": "f4c95383706ca83fe473fd981d94394c",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1527433011,
    "idp": "Google",
    "name": "MURAT AKKAÅž",
    "preferred_username": "4405b296-a304-436e-ad3f-739afefa4931",
    "amr": "external"
  }
}
2018-05-27 17:56:59.959 +03:00 [INF] End session request validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "PostLogOutUri": "http://localhost:4200",
  "Raw": {
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ4YjhlNTE4ODNkMjc0NGJkZGQxNzdkZTRmZGE4Yjk1IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1Mjc0MzMwMTMsImV4cCI6MTUyNzQzMzMxMywiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoiZGV3cy53ZWIiLCJub25jZSI6Ik4wLjA3ODU4NDU0NTY4OTA1ODM3MTUyNzQzMjk5NjkyNSIsImlhdCI6MTUyNzQzMzAxMywiYXRfaGFzaCI6ImR6NHNISGV6ZkZRQXNvRTh2azN6TkEiLCJzaWQiOiJmNGM5NTM4MzcwNmNhODNmZTQ3M2ZkOTgxZDk0Mzk0YyIsInN1YiI6ImM1ZTM3MGU2LTcyMTgtNDlkOC1hNTIwLTk4N2U2MzY5N2Q0MyIsImF1dGhfdGltZSI6MTUyNzQzMzAxMSwiaWRwIjoiR29vZ2xlIiwibmFtZSI6Ik1VUkFUIEFLS0HFniIsInByZWZlcnJlZF91c2VybmFtZSI6IjQ0MDViMjk2LWEzMDQtNDM2ZS1hZDNmLTczOWFmZWZhNDkzMSIsImFtciI6WyJleHRlcm5hbCJdfQ.FpFox6otCaHeoITopGCc8xDg2HOJq9mFytqSI7JcrY87z3dGSX7YlxjEFXyIzFH9Wii1Di1bD7eDwmp-8EFad05_9E6KRN5KOSShogjnPraTEJ6blsX52vaMxSYJnfoywZmbyvC3HiRdzkNpvOnhRJLGTIxtlRrMItIdkBbofzLxNGUIkRD4x5YB8il8ahEJAyEx223VJGyw3qz-g-1fZbbvcJl4sE2U0h5nZ3wHwRFJvrGGWHvp3vXwW1XpyCCOqSGFTmtS5KNXVkDiYgKzZkmihjuAT7M2yhTKcElQh2yzIfVRNmtn9i5fHcnasp_UUcyOpjJ12NPiXJUPNCg1Mg",
    "post_logout_redirect_uri": "http://localhost:4200"
  }
}
2018-05-27 17:56:59.966 +03:00 [DBG] Success validating end session request from dews.web
2018-05-27 17:56:59.982 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:56:59.990 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-05-27 17:57:00.126 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-05-27 17:57:00.155 +03:00 [INF] {
  "Name": "User Logout Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1002,
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "ActivityId": "0HLE3S7SOACHJ:0000000C",
  "TimeStamp": "2018-05-27T14:57:00Z",
  "ProcessId": 49356,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-05-27 17:57:00.173 +03:00 [INF] AuthenticationScheme: Identity.Application signed out.
2018-05-27 17:57:00.182 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-05-27 17:57:00.190 +03:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2018-05-27 17:57:00.299 +03:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2018-05-27 17:57:00.309 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2018-05-27 17:57:00.313 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2018-05-27 17:57:00.328 +03:00 [DBG] Processing signout callback request
2018-05-27 17:57:00.813 +03:00 [DBG] dews.web found in database: true
2018-05-27 17:57:00.818 +03:00 [DBG] No client front-channel logout URLs
2018-05-27 17:57:00.825 +03:00 [DBG] No client back-channel logout URLs
2018-05-27 17:57:00.829 +03:00 [INF] Successful signout callback.
2018-05-27 17:57:00.836 +03:00 [DBG] No client front-channel iframe urls
2018-05-27 17:57:00.842 +03:00 [DBG] No client back-channel iframe urls
2018-05-27 19:19:30.014 +03:00 [WRN] No XML encryptor configured. Key "87576612-1ef9-4fff-b13c-d2a5765ee6a1" may be persisted to storage in unencrypted form.
2018-05-27 19:19:30.381 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-05-27 19:19:30.390 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-05-27 19:19:30.393 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-05-27 19:19:30.398 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-05-27 19:19:30.401 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-05-27 19:19:30.673 +03:00 [DBG] Starting token cleanup
2018-05-27 19:21:10.710 +03:00 [WRN] No XML encryptor configured. Key "ab9e91e4-0749-4505-9baf-139f58947b4d" may be persisted to storage in unencrypted form.
2018-05-27 19:21:10.996 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-05-27 19:21:11.004 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-05-27 19:21:11.006 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-05-27 19:21:11.011 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-05-27 19:21:11.019 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-05-27 19:21:11.205 +03:00 [DBG] Starting token cleanup
2018-06-05 23:24:28.314 +03:00 [WRN] No XML encryptor configured. Key "9093ab36-d4ea-4b3d-9631-523a176360e8" may be persisted to storage in unencrypted form.
2018-06-05 23:24:28.699 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-05 23:24:28.712 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-05 23:24:28.717 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-05 23:24:28.719 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-05 23:24:28.723 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-05 23:24:29.002 +03:00 [DBG] Starting token cleanup
2018-06-05 23:24:56.943 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-05 23:24:56.973 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-05 23:24:56.976 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-05 23:24:56.994 +03:00 [DBG] Start authorize request
2018-06-05 23:24:57.006 +03:00 [DBG] No user present in authorize request
2018-06-05 23:24:57.023 +03:00 [DBG] Start authorize request protocol validation
2018-06-05 23:24:58.555 +03:00 [DBG] dews.web found in database: true
2018-06-05 23:24:58.678 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-05 23:24:59.166 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-05 23:24:59.210 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-05 23:24:59.380 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-05 23:24:59.398 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-05 23:24:59.509 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15282302969170.5828835270055848",
  "Nonce": "N0.225564376354114641528230296917",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.225564376354114641528230296917",
    "state": "15282302969170.5828835270055848"
  }
}
2018-06-05 23:24:59.528 +03:00 [INF] Showing login: User is not authenticated
2018-06-05 23:24:59.677 +03:00 [DBG] Start authorize request protocol validation
2018-06-05 23:24:59.750 +03:00 [DBG] dews.web found in database: true
2018-06-05 23:24:59.767 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-05 23:24:59.911 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-05 23:24:59.927 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-05 23:25:00.120 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-05 23:25:00.124 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-05 23:25:00.176 +03:00 [DBG] dews.web found in database: true
2018-06-05 23:25:08.557 +03:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-06-05 23:25:09.473 +03:00 [INF] {
  "Name": "User Login Failure",
  "Category": "Authentication",
  "EventType": "Failure",
  "Id": 1001,
  "Username": "m.akkas@gmail.com",
  "Endpoint": "UI",
  "Message": "invalid credentials",
  "ActivityId": "0HLEB49BFN9BH:00000009",
  "TimeStamp": "2018-06-05T20:25:09Z",
  "ProcessId": 39308,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-05 23:25:09.481 +03:00 [DBG] Start authorize request protocol validation
2018-06-05 23:25:09.548 +03:00 [DBG] dews.web found in database: true
2018-06-05 23:25:09.572 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-05 23:25:09.693 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-05 23:25:09.705 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-05 23:25:09.724 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-05 23:25:09.730 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-05 23:25:09.768 +03:00 [DBG] dews.web found in database: true
2018-06-05 23:25:16.637 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-05 23:25:23.019 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-05 23:25:23.073 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-05 23:25:23.272 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEB49BFN9BH:0000000C",
  "TimeStamp": "2018-06-05T20:25:23Z",
  "ProcessId": 39308,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-05 23:25:23.292 +03:00 [DBG] Augmenting SignInContext
2018-06-05 23:25:23.296 +03:00 [DBG] Adding amr claim with value: external
2018-06-05 23:25:23.309 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-05 23:25:23.324 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-05 23:25:23.353 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-05 23:25:23.359 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-05 23:25:23.363 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-05 23:25:23.369 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-05 23:25:23.376 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-05 23:25:23.390 +03:00 [DBG] Start authorize callback request
2018-06-05 23:25:23.401 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-05 23:25:23.407 +03:00 [DBG] Start authorize request protocol validation
2018-06-05 23:25:23.461 +03:00 [DBG] dews.web found in database: true
2018-06-05 23:25:23.475 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-05 23:25:23.500 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-05 23:25:23.513 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-05 23:25:23.538 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-05 23:25:23.544 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-05 23:25:23.548 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15282302969170.5828835270055848",
  "Nonce": "N0.225564376354114641528230296917",
  "SessionId": "3e5caba0b6307a4e74fc6ce58b5dfa04",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.225564376354114641528230296917",
    "state": "15282302969170.5828835270055848"
  }
}
2018-06-05 23:25:23.682 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-05 23:25:23.708 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-05 23:25:23.721 +03:00 [DBG] Creating Implicit Flow response.
2018-06-05 23:25:23.739 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-05 23:25:23.742 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-05 23:25:23.886 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-05 23:25:23.944 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****LVnA"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****A1cQ"
    }
  ],
  "ActivityId": "0HLEB49BFN9BH:0000000D",
  "TimeStamp": "2018-06-05T20:25:23Z",
  "ProcessId": 39308,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-05 23:25:23.957 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15282302969170.5828835270055848",
  "Scope": "openid profile dews.api"
}
2018-06-05 23:25:23.988 +03:00 [DBG] Augmenting SignInContext
2018-06-05 23:25:23.991 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-05 23:25:26.823 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-05 23:25:26.860 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-05 23:25:26.865 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-05 23:25:26.872 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-05 23:25:26.879 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-05 23:25:26.884 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-05 23:25:26.893 +03:00 [DBG] Start key discovery request
2018-06-05 23:25:27.178 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-05 23:25:27.196 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-05 23:25:27.201 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-05 23:25:27.206 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-05 23:25:27.212 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-05 23:25:27.216 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-05 23:25:27.229 +03:00 [DBG] Start userinfo request
2018-06-05 23:25:27.238 +03:00 [DBG] Bearer token found in header
2018-06-05 23:25:27.343 +03:00 [DBG] dews.web found in database: true
2018-06-05 23:25:27.374 +03:00 [DBG] dews.web found in database: true
2018-06-05 23:25:27.386 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-05 23:25:27.398 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528230323,
    "exp": 1528233923,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528230323,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-05 23:25:27.410 +03:00 [DBG] Creating userinfo response
2018-06-05 23:25:27.418 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-05 23:25:27.423 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-05 23:25:27.437 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-05 23:25:27.441 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-05 23:25:27.445 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-05 23:25:27.454 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-05 23:25:27.470 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-05 23:25:27.474 +03:00 [DBG] End userinfo request
2018-06-05 23:25:29.540 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-05 23:25:29.546 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-05 23:25:29.552 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-05 23:25:29.569 +03:00 [DBG] Start discovery request
2018-06-05 23:25:29.721 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-05 23:25:30.070 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-05 23:25:30.077 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-05 23:25:30.086 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-05 23:25:30.102 +03:00 [DBG] Start key discovery request
2018-06-05 23:26:45.073 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-05 23:26:45.089 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-05 23:26:45.093 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-06-05 23:26:45.098 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-06-05 23:26:45.104 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-06-05 23:26:45.119 +03:00 [DBG] Processing signout request for c5e370e6-7218-49d8-a520-987e63697d43
2018-06-05 23:26:45.134 +03:00 [DBG] Start end session request validation
2018-06-05 23:26:45.144 +03:00 [DBG] Start identity token validation
2018-06-05 23:26:45.220 +03:00 [DBG] dews.web found in database: true
2018-06-05 23:26:45.226 +03:00 [DBG] Client found: dews.web / Developer News
2018-06-05 23:26:45.272 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-05 23:26:45.277 +03:00 [DBG] Token validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "ValidateLifetime": false,
  "Claims": {
    "nbf": 1528230323,
    "exp": 1528230623,
    "iss": "http://localhost:5000",
    "aud": "dews.web",
    "nonce": "N0.225564376354114641528230296917",
    "iat": 1528230323,
    "at_hash": "kC_PIJMI54opjNNlBUBmpA",
    "sid": "3e5caba0b6307a4e74fc6ce58b5dfa04",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528230323,
    "idp": "Google",
    "name": "MURAT AKKAÅž",
    "preferred_username": "4405b296-a304-436e-ad3f-739afefa4931",
    "amr": "external"
  }
}
2018-06-05 23:26:45.293 +03:00 [INF] End session request validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "PostLogOutUri": "http://localhost:4200",
  "Raw": {
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ4YjhlNTE4ODNkMjc0NGJkZGQxNzdkZTRmZGE4Yjk1IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1MjgyMzAzMjMsImV4cCI6MTUyODIzMDYyMywiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoiZGV3cy53ZWIiLCJub25jZSI6Ik4wLjIyNTU2NDM3NjM1NDExNDY0MTUyODIzMDI5NjkxNyIsImlhdCI6MTUyODIzMDMyMywiYXRfaGFzaCI6ImtDX1BJSk1JNTRvcGpOTmxCVUJtcEEiLCJzaWQiOiIzZTVjYWJhMGI2MzA3YTRlNzRmYzZjZTU4YjVkZmEwNCIsInN1YiI6ImM1ZTM3MGU2LTcyMTgtNDlkOC1hNTIwLTk4N2U2MzY5N2Q0MyIsImF1dGhfdGltZSI6MTUyODIzMDMyMywiaWRwIjoiR29vZ2xlIiwibmFtZSI6Ik1VUkFUIEFLS0HFniIsInByZWZlcnJlZF91c2VybmFtZSI6IjQ0MDViMjk2LWEzMDQtNDM2ZS1hZDNmLTczOWFmZWZhNDkzMSIsImFtciI6WyJleHRlcm5hbCJdfQ.whB1lQNhhJGRD3myfzgyb7yj0Y78muJG9_x_edL39cH03etK9IEyZCjCg49kpPAo5vBXIXqr5XkFvQKs6i5IJ-6GLYNUC1SYYKyDw1BoRc1GunrgPHzfwb2rRGH2vU9pQYBiNdf2k8rav3SxNSqzE5lfb5b5M3Eq04O-hx-QA-tnReP863DYUrX2EsXVVMPATAyS3fiUNuHCs0quXeU7Mqwurv248GiwNI6nTBPRAiHhFb32D4HXOrxFVqpb_EFsX9-gJ-1WvtVmRD90GK--NZ42fychXHRGCZB9cuMUNsvV0DNNafXLgb4QJPG9WK0p-X0X0x0dQlhcrmKEg0LVnA",
    "post_logout_redirect_uri": "http://localhost:4200"
  }
}
2018-06-05 23:26:45.301 +03:00 [DBG] Success validating end session request from dews.web
2018-06-05 23:26:45.328 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-05 23:26:45.331 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-05 23:26:45.400 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-05 23:26:45.413 +03:00 [INF] {
  "Name": "User Logout Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1002,
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "ActivityId": "0HLEB49BFN9BH:0000000F",
  "TimeStamp": "2018-06-05T20:26:45Z",
  "ProcessId": 39308,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-05 23:26:45.419 +03:00 [INF] AuthenticationScheme: Identity.Application signed out.
2018-06-05 23:26:45.425 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-05 23:26:45.430 +03:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2018-06-05 23:26:46.106 +03:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2018-06-05 23:26:46.112 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2018-06-05 23:26:46.116 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2018-06-05 23:26:46.129 +03:00 [DBG] Processing signout callback request
2018-06-05 23:26:46.189 +03:00 [DBG] dews.web found in database: true
2018-06-05 23:26:46.191 +03:00 [DBG] No client front-channel logout URLs
2018-06-05 23:26:46.195 +03:00 [DBG] No client back-channel logout URLs
2018-06-05 23:26:46.197 +03:00 [INF] Successful signout callback.
2018-06-05 23:26:46.202 +03:00 [DBG] No client front-channel iframe urls
2018-06-05 23:26:46.205 +03:00 [DBG] No client back-channel iframe urls
2018-06-06 00:08:12.801 +03:00 [WRN] No XML encryptor configured. Key "29bcb1b4-5f76-4c54-b13a-17076c26a382" may be persisted to storage in unencrypted form.
2018-06-06 00:08:13.175 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-06 00:08:13.185 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-06 00:08:13.188 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-06 00:08:13.190 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-06 00:08:13.192 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-06 00:08:13.461 +03:00 [DBG] Starting token cleanup
2018-06-06 00:08:55.846 +03:00 [WRN] No XML encryptor configured. Key "72952d03-f983-468d-a2b0-412f68c34b30" may be persisted to storage in unencrypted form.
2018-06-06 00:08:56.210 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-06 00:08:56.218 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-06 00:08:56.220 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-06 00:08:56.222 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-06 00:08:56.223 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-06 00:08:56.427 +03:00 [DBG] Starting token cleanup
2018-06-06 00:09:18.118 +03:00 [WRN] No XML encryptor configured. Key "7d4ff593-c709-498d-a6c2-4ee29f6549c1" may be persisted to storage in unencrypted form.
2018-06-06 00:09:18.573 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-06 00:09:18.581 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-06 00:09:18.583 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-06 00:09:18.585 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-06 00:09:18.586 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-06 00:09:18.814 +03:00 [DBG] Starting token cleanup
2018-06-06 00:09:19.483 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-06 00:09:19.529 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-06 00:09:19.532 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-06 00:09:19.541 +03:00 [DBG] Start authorize request
2018-06-06 00:09:19.575 +03:00 [DBG] No user present in authorize request
2018-06-06 00:09:19.591 +03:00 [DBG] Start authorize request protocol validation
2018-06-06 00:09:20.989 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:09:21.080 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:09:21.419 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:09:21.447 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:09:21.465 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:09:21.481 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-06 00:09:21.569 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15282328769440.03242447465155118",
  "Nonce": "N0.752706601868221528232919424",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.752706601868221528232919424",
    "state": "15282328769440.03242447465155118"
  }
}
2018-06-06 00:09:21.588 +03:00 [INF] Showing login: User is not authenticated
2018-06-06 00:09:21.912 +03:00 [DBG] Start authorize request protocol validation
2018-06-06 00:09:21.951 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:09:21.961 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:09:21.978 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:09:21.989 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:09:22.010 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:09:22.013 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-06 00:09:22.046 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:09:34.038 +03:00 [WRN] No XML encryptor configured. Key "710ee304-2944-410d-9cb6-a4ba6ae66c85" may be persisted to storage in unencrypted form.
2018-06-06 00:09:34.975 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-06 00:09:34.990 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-06 00:09:34.994 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-06 00:09:34.997 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-06 00:09:35.003 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-06 00:09:35.557 +03:00 [DBG] Starting token cleanup
2018-06-06 00:09:54.137 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-06 00:09:54.157 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-06 00:09:54.160 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-06 00:09:54.172 +03:00 [DBG] Start authorize request
2018-06-06 00:09:54.190 +03:00 [DBG] No user present in authorize request
2018-06-06 00:09:54.218 +03:00 [DBG] Start authorize request protocol validation
2018-06-06 00:09:55.616 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:09:55.715 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:09:56.022 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:09:56.052 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:09:56.075 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:09:56.093 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-06 00:09:56.183 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15282329941190.7494247382462695",
  "Nonce": "N0.096814893963349971528232994119",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.096814893963349971528232994119",
    "state": "15282329941190.7494247382462695"
  }
}
2018-06-06 00:09:56.201 +03:00 [INF] Showing login: User is not authenticated
2018-06-06 00:09:56.325 +03:00 [DBG] Start authorize request protocol validation
2018-06-06 00:09:56.362 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:09:56.370 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:09:56.386 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:09:56.397 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:09:56.414 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:09:56.418 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-06 00:09:56.452 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:09:59.117 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-06 00:10:04.395 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-06 00:10:04.429 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-06 00:10:04.862 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEB52I4RL4D:00000006",
  "TimeStamp": "2018-06-05T21:10:04Z",
  "ProcessId": 16512,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-06 00:10:04.885 +03:00 [DBG] Augmenting SignInContext
2018-06-06 00:10:04.891 +03:00 [DBG] Adding amr claim with value: external
2018-06-06 00:10:04.900 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-06 00:10:04.913 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-06 00:10:04.943 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:10:04.948 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:10:04.952 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-06 00:10:04.958 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-06 00:10:04.962 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-06 00:10:04.976 +03:00 [DBG] Start authorize callback request
2018-06-06 00:10:04.988 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-06 00:10:04.994 +03:00 [DBG] Start authorize request protocol validation
2018-06-06 00:10:05.040 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:10:05.054 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:10:05.080 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:10:05.101 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:10:05.128 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:10:05.132 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-06 00:10:05.135 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15282329941190.7494247382462695",
  "Nonce": "N0.096814893963349971528232994119",
  "SessionId": "79f91a345c4aba65165f61eb35fcb302",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.096814893963349971528232994119",
    "state": "15282329941190.7494247382462695"
  }
}
2018-06-06 00:10:05.253 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-06 00:10:05.295 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-06 00:10:05.312 +03:00 [DBG] Creating Implicit Flow response.
2018-06-06 00:10:05.330 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-06 00:10:05.333 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-06 00:10:05.456 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-06 00:10:05.510 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****gAzw"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****ZIlg"
    }
  ],
  "ActivityId": "0HLEB52I4RL4D:00000007",
  "TimeStamp": "2018-06-05T21:10:05Z",
  "ProcessId": 16512,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-06 00:10:05.523 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15282329941190.7494247382462695",
  "Scope": "openid profile dews.api"
}
2018-06-06 00:10:05.559 +03:00 [DBG] Augmenting SignInContext
2018-06-06 00:10:05.562 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-06 00:10:07.973 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-06 00:10:08.000 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-06 00:10:08.004 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-06 00:10:08.011 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-06 00:10:08.016 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-06 00:10:08.020 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-06 00:10:08.032 +03:00 [DBG] Start key discovery request
2018-06-06 00:10:08.252 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-06 00:10:08.266 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-06 00:10:08.272 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-06 00:10:08.278 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-06 00:10:08.286 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-06 00:10:08.291 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-06 00:10:08.301 +03:00 [DBG] Start userinfo request
2018-06-06 00:10:08.308 +03:00 [DBG] Bearer token found in header
2018-06-06 00:10:08.410 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:10:08.444 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:10:08.457 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-06 00:10:08.469 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528233005,
    "exp": 1528236605,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528233004,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-06 00:10:08.492 +03:00 [DBG] Creating userinfo response
2018-06-06 00:10:08.499 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-06 00:10:08.505 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-06 00:10:08.516 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:10:08.520 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-06 00:10:08.523 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-06 00:10:08.531 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:10:08.545 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-06 00:10:08.549 +03:00 [DBG] End userinfo request
2018-06-06 00:10:23.012 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:10:23.019 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:10:23.022 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-06-06 00:10:23.029 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-06-06 00:10:23.033 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-06-06 00:10:23.046 +03:00 [DBG] Processing signout request for c5e370e6-7218-49d8-a520-987e63697d43
2018-06-06 00:10:23.061 +03:00 [DBG] Start end session request validation
2018-06-06 00:10:23.072 +03:00 [DBG] Start identity token validation
2018-06-06 00:10:23.112 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:10:23.114 +03:00 [DBG] Client found: dews.web / Developer News
2018-06-06 00:10:23.131 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-06 00:10:23.135 +03:00 [DBG] Token validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "ValidateLifetime": false,
  "Claims": {
    "nbf": 1528233005,
    "exp": 1528233305,
    "iss": "http://localhost:5000",
    "aud": "dews.web",
    "nonce": "N0.096814893963349971528232994119",
    "iat": 1528233005,
    "at_hash": "QEwIDgM9jaFMYZpWklb_3w",
    "sid": "79f91a345c4aba65165f61eb35fcb302",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528233004,
    "idp": "Google",
    "name": "MURAT AKKAÅž",
    "preferred_username": "4405b296-a304-436e-ad3f-739afefa4931",
    "amr": "external"
  }
}
2018-06-06 00:10:23.146 +03:00 [INF] End session request validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "PostLogOutUri": "http://localhost:4200",
  "Raw": {
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ4YjhlNTE4ODNkMjc0NGJkZGQxNzdkZTRmZGE4Yjk1IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1MjgyMzMwMDUsImV4cCI6MTUyODIzMzMwNSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoiZGV3cy53ZWIiLCJub25jZSI6Ik4wLjA5NjgxNDg5Mzk2MzM0OTk3MTUyODIzMjk5NDExOSIsImlhdCI6MTUyODIzMzAwNSwiYXRfaGFzaCI6IlFFd0lEZ005amFGTVlacFdrbGJfM3ciLCJzaWQiOiI3OWY5MWEzNDVjNGFiYTY1MTY1ZjYxZWIzNWZjYjMwMiIsInN1YiI6ImM1ZTM3MGU2LTcyMTgtNDlkOC1hNTIwLTk4N2U2MzY5N2Q0MyIsImF1dGhfdGltZSI6MTUyODIzMzAwNCwiaWRwIjoiR29vZ2xlIiwibmFtZSI6Ik1VUkFUIEFLS0HFniIsInByZWZlcnJlZF91c2VybmFtZSI6IjQ0MDViMjk2LWEzMDQtNDM2ZS1hZDNmLTczOWFmZWZhNDkzMSIsImFtciI6WyJleHRlcm5hbCJdfQ.hjXYBCs1KNm_6OdYDzMQWbUZP55KXIy_XOW6St3PAkXlWEvy9D2Z80v-sj4wb3aznl5LQk_0odKDZENtodw5tD755azdTYQcVFAlqQDlC0rcoyq2fXPMRRXwhewh1Ev2EEch4NAUVWad3Oc5gx002rVFUx7mDaaifJcphwJaakutmRE9wxWlnAAvDAIgWz6196H5r4fLl3Q04e6C9r5lVQ0-UxE5CwVmyC1F1DiSs74dCp32pabHfCVcs6ch6A1m6TVOsK3g_LE0l5my8jPorWODjNoj9cGswjYq6Bb2Hw_tpZuXYXrA24L7tD6z1YRaYn5ZY0wU4zcZDUJ7a9gAzw",
    "post_logout_redirect_uri": "http://localhost:4200"
  }
}
2018-06-06 00:10:23.154 +03:00 [DBG] Success validating end session request from dews.web
2018-06-06 00:10:23.181 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:10:23.185 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:10:23.249 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-06 00:10:23.263 +03:00 [INF] {
  "Name": "User Logout Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1002,
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "ActivityId": "0HLEB52I4RL4D:00000009",
  "TimeStamp": "2018-06-05T21:10:23Z",
  "ProcessId": 16512,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-06 00:10:23.270 +03:00 [INF] AuthenticationScheme: Identity.Application signed out.
2018-06-06 00:10:23.273 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-06 00:10:23.278 +03:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2018-06-06 00:10:23.649 +03:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2018-06-06 00:10:23.656 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2018-06-06 00:10:23.660 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2018-06-06 00:10:23.672 +03:00 [DBG] Processing signout callback request
2018-06-06 00:10:23.744 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:10:23.750 +03:00 [DBG] No client front-channel logout URLs
2018-06-06 00:10:23.755 +03:00 [DBG] No client back-channel logout URLs
2018-06-06 00:10:23.764 +03:00 [INF] Successful signout callback.
2018-06-06 00:10:23.768 +03:00 [DBG] No client front-channel iframe urls
2018-06-06 00:10:23.771 +03:00 [DBG] No client back-channel iframe urls
2018-06-06 00:16:30.779 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-06 00:16:30.784 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-06 00:16:30.787 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-06 00:16:30.790 +03:00 [DBG] Start authorize request
2018-06-06 00:16:30.794 +03:00 [DBG] No user present in authorize request
2018-06-06 00:16:30.797 +03:00 [DBG] Start authorize request protocol validation
2018-06-06 00:16:30.887 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:16:30.905 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:16:31.006 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:16:31.017 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:16:31.040 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:16:31.046 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-06 00:16:31.050 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15282329941190.7494247382462695",
  "Nonce": "N0.09675721144395611528233390761",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.09675721144395611528233390761",
    "state": "15282329941190.7494247382462695"
  }
}
2018-06-06 00:16:31.058 +03:00 [INF] Showing login: User is not authenticated
2018-06-06 00:16:31.080 +03:00 [DBG] Start authorize request protocol validation
2018-06-06 00:16:31.112 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:16:31.121 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:16:31.139 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:16:31.148 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:16:31.168 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:16:31.172 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-06 00:16:31.205 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:16:33.131 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-06 00:16:38.515 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-06 00:16:38.563 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-06 00:16:38.653 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEB52I4RL4M:00000005",
  "TimeStamp": "2018-06-05T21:16:38Z",
  "ProcessId": 16512,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-06 00:16:38.659 +03:00 [DBG] Augmenting SignInContext
2018-06-06 00:16:38.662 +03:00 [DBG] Adding amr claim with value: external
2018-06-06 00:16:38.665 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-06 00:16:38.668 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-06 00:16:38.683 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:16:38.687 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:16:38.690 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-06 00:16:38.693 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-06 00:16:38.697 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-06 00:16:38.700 +03:00 [DBG] Start authorize callback request
2018-06-06 00:16:38.704 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-06 00:16:38.708 +03:00 [DBG] Start authorize request protocol validation
2018-06-06 00:16:38.742 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:16:38.750 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:16:38.769 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:16:38.780 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:16:38.800 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-06 00:16:38.806 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-06 00:16:38.810 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15282329941190.7494247382462695",
  "Nonce": "N0.09675721144395611528233390761",
  "SessionId": "29dfa652413cba91f0078d76525fc30b",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.09675721144395611528233390761",
    "state": "15282329941190.7494247382462695"
  }
}
2018-06-06 00:16:38.848 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-06 00:16:38.862 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-06 00:16:38.866 +03:00 [DBG] Creating Implicit Flow response.
2018-06-06 00:16:38.868 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-06 00:16:38.872 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-06 00:16:38.890 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-06 00:16:38.901 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****TXOw"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****vklA"
    }
  ],
  "ActivityId": "0HLEB52I4RL4M:00000006",
  "TimeStamp": "2018-06-05T21:16:38Z",
  "ProcessId": 16512,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-06 00:16:38.908 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15282329941190.7494247382462695",
  "Scope": "openid profile dews.api"
}
2018-06-06 00:16:38.911 +03:00 [DBG] Augmenting SignInContext
2018-06-06 00:16:38.915 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-06 00:16:42.286 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-06 00:16:42.297 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-06 00:16:42.302 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-06 00:16:42.307 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-06 00:16:42.311 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-06 00:16:42.315 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-06 00:16:42.320 +03:00 [DBG] Start key discovery request
2018-06-06 00:16:42.571 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-06 00:16:42.611 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-06 00:16:42.617 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-06 00:16:42.623 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-06 00:16:42.627 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-06 00:16:42.630 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-06 00:16:42.647 +03:00 [DBG] Start userinfo request
2018-06-06 00:16:42.653 +03:00 [DBG] Bearer token found in header
2018-06-06 00:16:42.697 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:16:42.725 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:16:42.734 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-06 00:16:42.737 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528233398,
    "exp": 1528236998,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528233398,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-06 00:16:42.740 +03:00 [DBG] Creating userinfo response
2018-06-06 00:16:42.744 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-06 00:16:42.746 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-06 00:16:42.755 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:16:42.758 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-06 00:16:42.761 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-06 00:16:42.770 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-06 00:16:42.779 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-06 00:16:42.782 +03:00 [DBG] End userinfo request
2018-06-06 00:16:45.873 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-06 00:16:45.878 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-06 00:16:45.884 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-06 00:16:45.895 +03:00 [DBG] Start discovery request
2018-06-06 00:16:46.033 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-06 00:16:46.213 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-06 00:16:46.218 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-06 00:16:46.222 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-06 00:16:46.225 +03:00 [DBG] Start key discovery request
2018-06-06 00:17:39.517 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:17:39.524 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:17:39.528 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-06-06 00:17:39.531 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-06-06 00:17:39.534 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-06-06 00:17:39.540 +03:00 [DBG] Processing signout request for c5e370e6-7218-49d8-a520-987e63697d43
2018-06-06 00:17:39.544 +03:00 [DBG] Start end session request validation
2018-06-06 00:17:39.547 +03:00 [DBG] Start identity token validation
2018-06-06 00:17:39.614 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:17:39.617 +03:00 [DBG] Client found: dews.web / Developer News
2018-06-06 00:17:39.641 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-06 00:17:39.645 +03:00 [DBG] Token validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "ValidateLifetime": false,
  "Claims": {
    "nbf": 1528233398,
    "exp": 1528233698,
    "iss": "http://localhost:5000",
    "aud": "dews.web",
    "nonce": "N0.09675721144395611528233390761",
    "iat": 1528233398,
    "at_hash": "UKeFmXs-vdg7CK__WjVdxw",
    "sid": "29dfa652413cba91f0078d76525fc30b",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528233398,
    "idp": "Google",
    "name": "MURAT AKKAÅž",
    "preferred_username": "4405b296-a304-436e-ad3f-739afefa4931",
    "amr": "external"
  }
}
2018-06-06 00:17:39.650 +03:00 [INF] End session request validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "PostLogOutUri": "http://localhost:4200",
  "Raw": {
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ4YjhlNTE4ODNkMjc0NGJkZGQxNzdkZTRmZGE4Yjk1IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1MjgyMzMzOTgsImV4cCI6MTUyODIzMzY5OCwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoiZGV3cy53ZWIiLCJub25jZSI6Ik4wLjA5Njc1NzIxMTQ0Mzk1NjExNTI4MjMzMzkwNzYxIiwiaWF0IjoxNTI4MjMzMzk4LCJhdF9oYXNoIjoiVUtlRm1Ycy12ZGc3Q0tfX1dqVmR4dyIsInNpZCI6IjI5ZGZhNjUyNDEzY2JhOTFmMDA3OGQ3NjUyNWZjMzBiIiwic3ViIjoiYzVlMzcwZTYtNzIxOC00OWQ4LWE1MjAtOTg3ZTYzNjk3ZDQzIiwiYXV0aF90aW1lIjoxNTI4MjMzMzk4LCJpZHAiOiJHb29nbGUiLCJuYW1lIjoiTVVSQVQgQUtLQcWeIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiNDQwNWIyOTYtYTMwNC00MzZlLWFkM2YtNzM5YWZlZmE0OTMxIiwiYW1yIjpbImV4dGVybmFsIl19.vcy8nwIY4Q3HXL65hg5vKEnQC1aKDBVeYwryttO3qjKYdnvz-yaimzpaRr1uuyGp1CTeK5fT5CdFyvhpX67wdn2vRWD-6L9g3BeYNi-wr23k71twUZgIbc-tI_AyifAohXQTV1rjER5rP5SLLV7or8VVL8MEKlmYcV4fzmt4uNr5bdryC6m6hBKrX0Ejjqp7S5BIs74aENNXsx0W-EFIbOW_2PNUslwywcgyyIn6IBtDjMFbVwIt8Fyw7z7E9sftr92llLMlmLFpk2EC5kPPbNOwQWFCEI4j2YSm9f0oQVrLl_bdCDaJwAjDatC41ruG1JR0TYmRHk85A75klgTXOw",
    "post_logout_redirect_uri": "http://localhost:4200"
  }
}
2018-06-06 00:17:39.655 +03:00 [DBG] Success validating end session request from dews.web
2018-06-06 00:17:39.669 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:17:39.673 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-06 00:17:39.679 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-06 00:17:39.682 +03:00 [INF] {
  "Name": "User Logout Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1002,
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "ActivityId": "0HLEB52I4RL4M:00000008",
  "TimeStamp": "2018-06-05T21:17:39Z",
  "ProcessId": 16512,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-06 00:17:39.685 +03:00 [INF] AuthenticationScheme: Identity.Application signed out.
2018-06-06 00:17:39.689 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-06 00:17:39.692 +03:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2018-06-06 00:17:40.098 +03:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2018-06-06 00:17:40.105 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2018-06-06 00:17:40.111 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2018-06-06 00:17:40.116 +03:00 [DBG] Processing signout callback request
2018-06-06 00:17:40.188 +03:00 [DBG] dews.web found in database: true
2018-06-06 00:17:40.195 +03:00 [DBG] No client front-channel logout URLs
2018-06-06 00:17:40.198 +03:00 [DBG] No client back-channel logout URLs
2018-06-06 00:17:40.204 +03:00 [INF] Successful signout callback.
2018-06-06 00:17:40.217 +03:00 [DBG] No client front-channel iframe urls
2018-06-06 00:17:40.228 +03:00 [DBG] No client back-channel iframe urls
2018-06-07 00:20:03.724 +03:00 [WRN] No XML encryptor configured. Key "59299d3d-2cbc-4595-9f5e-1a6c01684fe1" may be persisted to storage in unencrypted form.
2018-06-07 00:20:04.161 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 00:20:04.172 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 00:20:04.177 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 00:20:04.179 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 00:20:04.181 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 00:20:04.454 +03:00 [DBG] Starting token cleanup
2018-06-07 00:20:52.157 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 00:20:52.181 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 00:20:52.183 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 00:20:52.202 +03:00 [DBG] Start authorize request
2018-06-07 00:20:52.214 +03:00 [DBG] No user present in authorize request
2018-06-07 00:20:52.231 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 00:20:53.871 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:20:53.986 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:20:54.294 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:20:54.322 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:20:54.342 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:20:54.361 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 00:20:54.456 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283200521130.5829722241633575",
  "Nonce": "N0.54080662326036571528320052114",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.54080662326036571528320052114",
    "state": "15283200521130.5829722241633575"
  }
}
2018-06-07 00:20:54.473 +03:00 [INF] Showing login: User is not authenticated
2018-06-07 00:20:54.587 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 00:20:54.628 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:20:54.638 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:20:54.656 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:20:54.664 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:20:54.681 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:20:54.684 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 00:20:54.720 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:20:57.604 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-07 00:21:02.661 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-07 00:21:02.703 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-07 00:21:03.049 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEBUD2N81LU:00000006",
  "TimeStamp": "2018-06-06T21:21:03Z",
  "ProcessId": 25564,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 00:21:03.068 +03:00 [DBG] Augmenting SignInContext
2018-06-07 00:21:03.073 +03:00 [DBG] Adding amr claim with value: external
2018-06-07 00:21:03.083 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 00:21:03.095 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-07 00:21:03.125 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 00:21:03.132 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 00:21:03.135 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-07 00:21:03.141 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-07 00:21:03.144 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-07 00:21:03.155 +03:00 [DBG] Start authorize callback request
2018-06-07 00:21:03.165 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 00:21:03.168 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 00:21:03.204 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:21:03.216 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:21:03.239 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:21:03.252 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:21:03.275 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:21:03.281 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 00:21:03.285 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283200521130.5829722241633575",
  "Nonce": "N0.54080662326036571528320052114",
  "SessionId": "3612a33ac77cbd08acfd8df35dc77373",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.54080662326036571528320052114",
    "state": "15283200521130.5829722241633575"
  }
}
2018-06-07 00:21:03.420 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-07 00:21:03.454 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-07 00:21:03.473 +03:00 [DBG] Creating Implicit Flow response.
2018-06-07 00:21:03.495 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-07 00:21:03.499 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 00:21:03.649 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-07 00:21:03.694 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****n9oQ"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****esJA"
    }
  ],
  "ActivityId": "0HLEBUD2N81LU:00000007",
  "TimeStamp": "2018-06-06T21:21:03Z",
  "ProcessId": 25564,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 00:21:03.706 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15283200521130.5829722241633575",
  "Scope": "openid profile dews.api"
}
2018-06-07 00:21:03.741 +03:00 [DBG] Augmenting SignInContext
2018-06-07 00:21:03.746 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 00:21:06.260 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-07 00:21:06.294 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 00:21:06.298 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 00:21:06.305 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 00:21:06.313 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 00:21:06.317 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 00:21:06.326 +03:00 [DBG] Start key discovery request
2018-06-07 00:21:06.566 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-07 00:21:06.578 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 00:21:06.582 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 00:21:06.587 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-07 00:21:06.595 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-07 00:21:06.602 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-07 00:21:06.615 +03:00 [DBG] Start userinfo request
2018-06-07 00:21:06.622 +03:00 [DBG] Bearer token found in header
2018-06-07 00:21:06.748 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:21:06.777 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:21:06.788 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-07 00:21:06.799 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528320063,
    "exp": 1528323663,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528320063,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-07 00:21:06.820 +03:00 [DBG] Creating userinfo response
2018-06-07 00:21:06.828 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 00:21:06.833 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 00:21:06.845 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:21:06.850 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-07 00:21:06.852 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 00:21:06.862 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:21:06.885 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-07 00:21:06.891 +03:00 [DBG] End userinfo request
2018-06-07 00:21:09.049 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 00:21:09.052 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 00:21:09.055 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 00:21:09.066 +03:00 [DBG] Start discovery request
2018-06-07 00:21:09.198 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 00:21:09.411 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 00:21:09.418 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 00:21:09.426 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 00:21:09.430 +03:00 [DBG] Start key discovery request
2018-06-07 00:26:06.322 +03:00 [WRN] No XML encryptor configured. Key "2a91714d-0e82-4bd6-bd04-e7230e03b726" may be persisted to storage in unencrypted form.
2018-06-07 00:26:06.664 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 00:26:06.673 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 00:26:06.677 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 00:26:06.680 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 00:26:06.683 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 00:26:06.947 +03:00 [DBG] Starting token cleanup
2018-06-07 00:26:07.271 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:26:07.297 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:26:07.308 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 00:26:07.333 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 00:26:07.336 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 00:26:07.343 +03:00 [DBG] Start authorize request
2018-06-07 00:26:07.353 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:26:07.361 +03:00 [DBG] No user present in authorize request
2018-06-07 00:26:07.376 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 00:26:08.207 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:26:08.228 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:26:10.249 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:26:10.416 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.68808094921939911528320365156",
    "state": "15283200521130.5829722241633575",
    "prompt": "none"
  }
}
2018-06-07 00:26:10.432 +03:00 [ERR] Request validation failed
2018-06-07 00:26:10.435 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.68808094921939911528320365156",
    "state": "15283200521130.5829722241633575",
    "prompt": "none"
  }
}
2018-06-07 00:26:10.520 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEBUGENV8GQ:00000001",
  "TimeStamp": "2018-06-06T21:26:10Z",
  "ProcessId": 27292,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 00:26:10.588 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:26:10.592 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:26:23.282 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 00:26:23.289 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 00:26:23.292 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 00:26:23.301 +03:00 [DBG] Start discovery request
2018-06-07 00:26:23.654 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 00:26:24.030 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 00:26:24.037 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 00:26:24.039 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 00:26:24.046 +03:00 [DBG] Start key discovery request
2018-06-07 00:28:54.187 +03:00 [WRN] No XML encryptor configured. Key "9b57992e-463d-4927-812b-b2a317c77500" may be persisted to storage in unencrypted form.
2018-06-07 00:28:54.484 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 00:28:54.492 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 00:28:54.494 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 00:28:54.496 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 00:28:54.499 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 00:28:54.757 +03:00 [DBG] Starting token cleanup
2018-06-07 00:28:55.599 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:28:55.640 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:29:13.028 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 00:29:13.041 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 00:29:13.044 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 00:29:13.055 +03:00 [DBG] Start discovery request
2018-06-07 00:29:14.274 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 00:29:14.693 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 00:29:14.699 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 00:29:14.702 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 00:29:14.710 +03:00 [DBG] Start key discovery request
2018-06-07 00:48:18.470 +03:00 [WRN] No XML encryptor configured. Key "6b1a11e9-f626-4e7e-b71b-ea2ab1018131" may be persisted to storage in unencrypted form.
2018-06-07 00:48:18.959 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 00:48:18.970 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 00:48:18.973 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 00:48:18.975 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 00:48:18.978 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 00:48:19.213 +03:00 [DBG] Starting token cleanup
2018-06-07 00:48:20.378 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:20.405 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:33.013 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:33.051 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:33.068 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 00:48:33.080 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 00:48:33.084 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 00:48:33.096 +03:00 [DBG] Start authorize request
2018-06-07 00:48:33.103 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:33.114 +03:00 [DBG] No user present in authorize request
2018-06-07 00:48:33.138 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 00:48:35.250 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:48:35.420 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:48:35.970 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:48:36.080 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:48:36.403 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:48:36.435 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 00:48:36.531 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.090355268324072921528321712950",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.090355268324072921528321712950",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 00:48:36.549 +03:00 [INF] Showing login: User is not authenticated
2018-06-07 00:48:36.574 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:36.580 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:36.740 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:36.744 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 00:48:37.343 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:48:37.463 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:48:37.851 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:48:37.965 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:48:38.364 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:48:38.369 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 00:48:38.851 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:48:39.676 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {59299d3d-2cbc-4595-9f5e-1a6c01684fe1} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-07 00:48:41.915 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:41.933 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:42.036 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-07 00:48:47.174 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-07 00:48:47.209 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:47.220 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:47.310 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-07 00:48:47.998 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEBUSRRH0DT:00000006",
  "TimeStamp": "2018-06-06T21:48:47Z",
  "ProcessId": 13672,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 00:48:48.019 +03:00 [DBG] Augmenting SignInContext
2018-06-07 00:48:48.025 +03:00 [DBG] Adding amr claim with value: external
2018-06-07 00:48:48.034 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 00:48:48.047 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 00:48:48.065 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-07 00:48:48.099 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 00:48:48.105 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 00:48:48.110 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-07 00:48:48.118 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-07 00:48:48.121 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-07 00:48:48.135 +03:00 [DBG] Start authorize callback request
2018-06-07 00:48:48.144 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 00:48:48.149 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 00:48:49.090 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:48:49.275 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:48:49.831 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:48:50.004 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:48:50.485 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 00:48:50.490 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 00:48:50.494 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.090355268324072921528321712950",
  "SessionId": "49d9d166c80a5fe54c262cc3a71206fb",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.090355268324072921528321712950",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 00:48:50.783 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-07 00:48:50.815 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-07 00:48:50.828 +03:00 [DBG] Creating Implicit Flow response.
2018-06-07 00:48:50.852 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-07 00:48:50.855 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 00:48:51.052 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-07 00:48:51.179 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****AkDg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****J9Eg"
    }
  ],
  "ActivityId": "0HLEBUSRRH0DT:00000007",
  "TimeStamp": "2018-06-06T21:48:51Z",
  "ProcessId": 13672,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 00:48:51.197 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15283217129500.40261816078851753",
  "Scope": "openid profile dews.api"
}
2018-06-07 00:48:51.228 +03:00 [DBG] Augmenting SignInContext
2018-06-07 00:48:51.231 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 00:48:53.748 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-07 00:48:53.804 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 00:48:53.807 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 00:48:53.816 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 00:48:53.824 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 00:48:53.828 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 00:48:53.841 +03:00 [DBG] Start key discovery request
2018-06-07 00:48:54.051 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-07 00:48:54.082 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 00:48:54.087 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 00:48:54.093 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-07 00:48:54.104 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-07 00:48:54.108 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-07 00:48:54.120 +03:00 [DBG] Start userinfo request
2018-06-07 00:48:54.126 +03:00 [DBG] Bearer token found in header
2018-06-07 00:48:54.559 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:48:54.874 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:48:54.916 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-07 00:48:54.931 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528321730,
    "exp": 1528325330,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528321728,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-07 00:48:54.944 +03:00 [DBG] Creating userinfo response
2018-06-07 00:48:54.952 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 00:48:54.957 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 00:48:55.020 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:48:55.034 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-07 00:48:55.038 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 00:48:55.097 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 00:48:55.182 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-07 00:48:55.186 +03:00 [DBG] End userinfo request
2018-06-07 00:52:57.411 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 00:52:57.419 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 00:52:57.422 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 00:52:57.432 +03:00 [DBG] Start discovery request
2018-06-07 00:52:57.823 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 00:52:58.172 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 00:52:58.187 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 00:52:58.217 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 00:52:58.225 +03:00 [DBG] Start key discovery request
2018-06-07 00:53:51.962 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 00:53:51.971 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 00:53:51.978 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 00:53:51.984 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 00:53:51.993 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 00:53:51.998 +03:00 [DBG] Start authorize request
2018-06-07 00:53:52.001 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 00:53:52.005 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 00:53:52.075 +03:00 [DBG] dews.web found in database: true
2018-06-07 00:53:52.076 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.093045163669771561528322031941",
    "state": "15283217129500.40261816078851753",
    "prompt": "none"
  }
}
2018-06-07 00:53:52.082 +03:00 [ERR] Request validation failed
2018-06-07 00:53:52.082 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.093045163669771561528322031941",
    "state": "15283217129500.40261816078851753",
    "prompt": "none"
  }
}
2018-06-07 00:53:52.093 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEBUSRRH0E8:00000001",
  "TimeStamp": "2018-06-06T21:53:52Z",
  "ProcessId": 13672,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 00:53:52.113 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 00:53:52.114 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:10:54.303 +03:00 [WRN] No XML encryptor configured. Key "f300d9cd-3e05-4def-b9ea-1ab4e0293b6f" may be persisted to storage in unencrypted form.
2018-06-07 01:10:54.600 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 01:10:54.608 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 01:10:54.611 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 01:10:54.613 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 01:10:54.615 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 01:10:54.840 +03:00 [DBG] Starting token cleanup
2018-06-07 01:10:55.935 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:10:55.970 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:09.547 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:09.554 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:09.564 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 01:11:09.578 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 01:11:09.579 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 01:11:09.587 +03:00 [DBG] Start authorize request
2018-06-07 01:11:09.595 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:09.602 +03:00 [DBG] No user present in authorize request
2018-06-07 01:11:09.614 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:11:10.841 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:11:10.923 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:11:11.236 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:11:11.260 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:11:11.266 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:11:11.281 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:11:11.365 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.85009405742214721528323069517",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.85009405742214721528323069517",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 01:11:11.379 +03:00 [INF] Showing login: User is not authenticated
2018-06-07 01:11:11.390 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:11.392 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:11.468 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:11.471 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:11:11.486 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:11:11.490 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:11:11.495 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:11:11.498 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:11:11.503 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:11:11.505 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:11:11.516 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:11:12.216 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {6b1a11e9-f626-4e7e-b71b-ea2ab1018131} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-07 01:11:14.132 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:14.135 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:14.156 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-07 01:11:19.889 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-07 01:11:19.899 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:19.902 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:19.924 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-07 01:11:20.261 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEBV9FQUFF4:00000006",
  "TimeStamp": "2018-06-06T22:11:20Z",
  "ProcessId": 48584,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 01:11:20.279 +03:00 [DBG] Augmenting SignInContext
2018-06-07 01:11:20.281 +03:00 [DBG] Adding amr claim with value: external
2018-06-07 01:11:20.289 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:11:20.293 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 01:11:20.304 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-07 01:11:20.315 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:11:20.317 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:11:20.321 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-07 01:11:20.324 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-07 01:11:20.325 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-07 01:11:20.337 +03:00 [DBG] Start authorize callback request
2018-06-07 01:11:20.345 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 01:11:20.348 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:11:20.358 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:11:20.362 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:11:20.369 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:11:20.373 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:11:20.379 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:11:20.380 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:11:20.382 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.85009405742214721528323069517",
  "SessionId": "f71d5ec9707ee198019fc6a484fc668e",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.85009405742214721528323069517",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 01:11:20.513 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-07 01:11:20.555 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-07 01:11:20.575 +03:00 [DBG] Creating Implicit Flow response.
2018-06-07 01:11:20.603 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-07 01:11:20.605 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 01:11:20.770 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-07 01:11:20.818 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****E3Kg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****CMWw"
    }
  ],
  "ActivityId": "0HLEBV9FQUFF4:00000007",
  "TimeStamp": "2018-06-06T22:11:20Z",
  "ProcessId": 48584,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 01:11:20.830 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15283217129500.40261816078851753",
  "Scope": "openid profile dews.api"
}
2018-06-07 01:11:20.857 +03:00 [DBG] Augmenting SignInContext
2018-06-07 01:11:20.857 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 01:11:23.213 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-07 01:11:23.232 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 01:11:23.233 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 01:11:23.235 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:11:23.240 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:11:23.242 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:11:23.251 +03:00 [DBG] Start key discovery request
2018-06-07 01:11:23.460 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-07 01:11:23.466 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 01:11:23.468 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 01:11:23.469 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-07 01:11:23.474 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-07 01:11:23.477 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-07 01:11:23.490 +03:00 [DBG] Start userinfo request
2018-06-07 01:11:23.496 +03:00 [DBG] Bearer token found in header
2018-06-07 01:11:23.573 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:11:23.583 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:11:23.587 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-07 01:11:23.594 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528323080,
    "exp": 1528326680,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528323080,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-07 01:11:23.604 +03:00 [DBG] Creating userinfo response
2018-06-07 01:11:23.608 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:11:23.612 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:11:23.618 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:11:23.620 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-07 01:11:23.622 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:11:23.625 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:11:23.629 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-07 01:11:23.631 +03:00 [DBG] End userinfo request
2018-06-07 01:11:26.665 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 01:11:26.670 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 01:11:26.672 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 01:11:26.682 +03:00 [DBG] Start discovery request
2018-06-07 01:11:26.783 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 01:11:26.899 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:11:26.903 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:11:26.906 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:11:26.908 +03:00 [DBG] Start key discovery request
2018-06-07 01:17:51.549 +03:00 [WRN] No XML encryptor configured. Key "a1c17a99-a925-4946-80ad-b6a2bb03402a" may be persisted to storage in unencrypted form.
2018-06-07 01:17:51.936 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 01:17:51.945 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 01:17:51.948 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 01:17:51.950 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 01:17:51.953 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 01:17:52.208 +03:00 [DBG] Starting token cleanup
2018-06-07 01:17:53.420 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:17:53.456 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:24.120 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:24.128 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:24.136 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 01:18:24.150 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 01:18:24.153 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 01:18:24.160 +03:00 [DBG] Start authorize request
2018-06-07 01:18:24.172 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:24.183 +03:00 [DBG] No user present in authorize request
2018-06-07 01:18:24.193 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:18:25.704 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:18:25.794 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:18:26.110 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:18:26.135 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:18:26.142 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:18:26.159 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:18:26.247 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.82546881222022341528323504110",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.82546881222022341528323504110",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 01:18:26.260 +03:00 [INF] Showing login: User is not authenticated
2018-06-07 01:18:26.273 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:26.274 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:26.373 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:26.376 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:18:26.389 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:18:26.392 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:18:26.398 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:18:26.403 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:18:26.409 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:18:26.411 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:18:26.426 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:18:27.126 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {f300d9cd-3e05-4def-b9ea-1ab4e0293b6f} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-07 01:18:29.265 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:29.274 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:29.332 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-07 01:18:34.933 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-07 01:18:34.952 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:34.953 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:34.970 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-07 01:18:35.318 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEBVDC6OFFU:00000005",
  "TimeStamp": "2018-06-06T22:18:35Z",
  "ProcessId": 10684,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 01:18:35.336 +03:00 [DBG] Augmenting SignInContext
2018-06-07 01:18:35.339 +03:00 [DBG] Adding amr claim with value: external
2018-06-07 01:18:35.345 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:18:35.348 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 01:18:35.363 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-07 01:18:35.373 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:18:35.376 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:18:35.377 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-07 01:18:35.379 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-07 01:18:35.381 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-07 01:18:35.391 +03:00 [DBG] Start authorize callback request
2018-06-07 01:18:35.398 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 01:18:35.400 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:18:35.409 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:18:35.411 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:18:35.417 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:18:35.421 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:18:35.427 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:18:35.429 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:18:35.430 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.82546881222022341528323504110",
  "SessionId": "1b56830c4a0736f80c0f83eabde01aa7",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.82546881222022341528323504110",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 01:18:35.520 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-07 01:18:35.547 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-07 01:18:35.562 +03:00 [DBG] Creating Implicit Flow response.
2018-06-07 01:18:35.584 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-07 01:18:35.585 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 01:18:35.692 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-07 01:18:35.726 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****E35g"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****F1rQ"
    }
  ],
  "ActivityId": "0HLEBVDC6OFFU:00000006",
  "TimeStamp": "2018-06-06T22:18:35Z",
  "ProcessId": 10684,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 01:18:35.736 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15283217129500.40261816078851753",
  "Scope": "openid profile dews.api"
}
2018-06-07 01:18:35.771 +03:00 [DBG] Augmenting SignInContext
2018-06-07 01:18:35.775 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 01:18:38.461 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-07 01:18:38.486 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 01:18:38.490 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 01:18:38.492 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:18:38.496 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:18:38.497 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:18:38.506 +03:00 [DBG] Start key discovery request
2018-06-07 01:18:38.751 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-07 01:18:38.760 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 01:18:38.762 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 01:18:38.765 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-07 01:18:38.770 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-07 01:18:38.772 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-07 01:18:38.787 +03:00 [DBG] Start userinfo request
2018-06-07 01:18:38.795 +03:00 [DBG] Bearer token found in header
2018-06-07 01:18:38.885 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:18:38.897 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:18:38.904 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-07 01:18:38.915 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528323515,
    "exp": 1528327115,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528323515,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-07 01:18:38.930 +03:00 [DBG] Creating userinfo response
2018-06-07 01:18:38.935 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:18:38.940 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:18:38.946 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:18:38.948 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-07 01:18:38.949 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:18:38.953 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:18:38.959 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-07 01:18:38.960 +03:00 [DBG] End userinfo request
2018-06-07 01:18:41.724 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 01:18:41.726 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 01:18:41.728 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 01:18:41.733 +03:00 [DBG] Start discovery request
2018-06-07 01:18:41.848 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 01:18:42.026 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:18:42.028 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:18:42.029 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:18:42.031 +03:00 [DBG] Start key discovery request
2018-06-07 01:23:37.128 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:23:37.136 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:23:37.139 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 01:23:37.148 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 01:23:37.152 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 01:23:37.157 +03:00 [DBG] Start authorize request
2018-06-07 01:23:37.159 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 01:23:37.167 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:23:37.228 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:23:37.229 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.99752945905052081528323817101",
    "state": "15283217129500.40261816078851753",
    "prompt": "none"
  }
}
2018-06-07 01:23:37.237 +03:00 [ERR] Request validation failed
2018-06-07 01:23:37.237 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.99752945905052081528323817101",
    "state": "15283217129500.40261816078851753",
    "prompt": "none"
  }
}
2018-06-07 01:23:37.249 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEBVDC6OFG2:00000001",
  "TimeStamp": "2018-06-06T22:23:37Z",
  "ProcessId": 10684,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 01:23:37.263 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:23:37.265 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:32:37.129 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 01:32:37.132 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 01:32:37.133 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 01:32:37.134 +03:00 [DBG] Start discovery request
2018-06-07 01:32:37.159 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 01:32:37.459 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:32:37.461 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:32:37.462 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:32:37.464 +03:00 [DBG] Start key discovery request
2018-06-07 01:37:46.270 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 01:37:46.273 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 01:37:46.275 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 01:37:46.276 +03:00 [DBG] Start discovery request
2018-06-07 01:37:46.300 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 01:37:46.572 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:37:46.575 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:37:46.577 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:37:46.579 +03:00 [DBG] Start key discovery request
2018-06-07 01:40:30.200 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 01:40:30.202 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 01:40:30.203 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 01:40:30.205 +03:00 [DBG] Start discovery request
2018-06-07 01:40:30.224 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 01:40:30.544 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:40:30.546 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:40:30.547 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:40:30.549 +03:00 [DBG] Start key discovery request
2018-06-07 01:41:08.584 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 01:41:08.586 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 01:41:08.587 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 01:41:08.589 +03:00 [DBG] Start discovery request
2018-06-07 01:41:08.611 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 01:41:08.968 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:41:08.969 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:41:08.970 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:41:08.971 +03:00 [DBG] Start key discovery request
2018-06-07 01:53:13.215 +03:00 [WRN] No XML encryptor configured. Key "5d3f8124-a479-4abe-a901-6419f07568ca" may be persisted to storage in unencrypted form.
2018-06-07 01:53:13.598 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 01:53:13.608 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 01:53:13.610 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 01:53:13.613 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 01:53:13.616 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 01:53:13.899 +03:00 [DBG] Starting token cleanup
2018-06-07 01:53:14.267 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:14.299 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:14.317 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 01:53:14.349 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 01:53:14.353 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 01:53:14.363 +03:00 [DBG] Start authorize request
2018-06-07 01:53:14.377 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:14.392 +03:00 [DBG] No user present in authorize request
2018-06-07 01:53:14.418 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:53:15.048 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:15.068 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:17.496 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:53:17.744 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:53:18.331 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:53:18.436 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:53:18.594 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:53:18.614 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:53:18.726 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.0136672125390153721528325593987",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.0136672125390153721528325593987",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 01:53:18.743 +03:00 [INF] Showing login: User is not authenticated
2018-06-07 01:53:18.822 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:18.825 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:18.951 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:18.956 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:53:19.397 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:53:19.483 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:53:19.711 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:53:19.806 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:53:20.034 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:53:20.041 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:53:20.437 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:53:22.407 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {a1c17a99-a925-4946-80ad-b6a2bb03402a} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-07 01:53:24.649 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:24.660 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:24.743 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-07 01:53:30.221 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-07 01:53:30.243 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:30.249 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:30.338 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-07 01:53:30.954 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEC014GE5OE:00000004",
  "TimeStamp": "2018-06-06T22:53:30Z",
  "ProcessId": 16084,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 01:53:30.974 +03:00 [DBG] Augmenting SignInContext
2018-06-07 01:53:30.980 +03:00 [DBG] Adding amr claim with value: external
2018-06-07 01:53:30.986 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:53:30.994 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 01:53:31.006 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-07 01:53:31.031 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:53:31.037 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:53:31.042 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-07 01:53:31.047 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-07 01:53:31.051 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-07 01:53:31.065 +03:00 [DBG] Start authorize callback request
2018-06-07 01:53:31.078 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 01:53:31.082 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:53:31.929 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:53:32.080 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:53:32.445 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:53:32.593 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:53:32.995 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:53:33.000 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:53:33.004 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.0136672125390153721528325593987",
  "SessionId": "e9d3f17b515167397116a06fe21ca3ef",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.0136672125390153721528325593987",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 01:53:33.252 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-07 01:53:33.286 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-07 01:53:33.321 +03:00 [DBG] Creating Implicit Flow response.
2018-06-07 01:53:33.369 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-07 01:53:33.375 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 01:53:33.607 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-07 01:53:33.718 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****WA3g"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****miUg"
    }
  ],
  "ActivityId": "0HLEC014GE5OE:00000005",
  "TimeStamp": "2018-06-06T22:53:33Z",
  "ProcessId": 16084,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 01:53:33.736 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15283217129500.40261816078851753",
  "Scope": "openid profile dews.api"
}
2018-06-07 01:53:33.786 +03:00 [DBG] Augmenting SignInContext
2018-06-07 01:53:33.798 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 01:53:36.431 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-07 01:53:36.488 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 01:53:36.492 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 01:53:36.504 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:53:36.516 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:53:36.521 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:53:36.538 +03:00 [DBG] Start key discovery request
2018-06-07 01:53:36.757 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-07 01:53:36.806 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 01:53:36.810 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 01:53:36.816 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-07 01:53:36.823 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-07 01:53:36.825 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-07 01:53:36.838 +03:00 [DBG] Start userinfo request
2018-06-07 01:53:36.844 +03:00 [DBG] Bearer token found in header
2018-06-07 01:53:37.247 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:53:37.543 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:53:37.588 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-07 01:53:37.609 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528325613,
    "exp": 1528329213,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528325610,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-07 01:53:37.643 +03:00 [DBG] Creating userinfo response
2018-06-07 01:53:37.655 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:53:37.666 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:53:37.751 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:53:37.756 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-07 01:53:37.766 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:53:37.868 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:53:37.972 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-07 01:53:37.979 +03:00 [DBG] End userinfo request
2018-06-07 01:53:38.578 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 01:53:38.583 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 01:53:38.588 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 01:53:38.598 +03:00 [DBG] Start discovery request
2018-06-07 01:53:38.974 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 01:53:39.327 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:53:39.336 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:53:39.349 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:53:39.354 +03:00 [DBG] Start key discovery request
2018-06-07 01:57:01.629 +03:00 [WRN] No XML encryptor configured. Key "88c99e32-07b8-43c4-9041-414ae341a3c8" may be persisted to storage in unencrypted form.
2018-06-07 01:57:01.983 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 01:57:01.991 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 01:57:01.996 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 01:57:01.999 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 01:57:02.001 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 01:57:02.235 +03:00 [DBG] Starting token cleanup
2018-06-07 01:57:03.346 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:03.400 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:15.152 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:15.162 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:15.176 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-06-07 01:57:15.188 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-06-07 01:57:15.191 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-06-07 01:57:15.207 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:15.211 +03:00 [DBG] Processing signout request for anonymous
2018-06-07 01:57:15.223 +03:00 [DBG] Start end session request validation
2018-06-07 01:57:15.245 +03:00 [DBG] Start identity token validation
2018-06-07 01:57:17.224 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:57:17.227 +03:00 [DBG] Client found: dews.web / Developer News
2018-06-07 01:57:17.496 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-07 01:57:17.544 +03:00 [DBG] Token validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "ValidateLifetime": false,
  "Claims": {
    "nbf": 1528325613,
    "exp": 1528325913,
    "iss": "http://localhost:5000",
    "aud": "dews.web",
    "nonce": "N0.0136672125390153721528325593987",
    "iat": 1528325613,
    "at_hash": "dO2HX3lncmk0uh6_ErBCng",
    "sid": "e9d3f17b515167397116a06fe21ca3ef",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528325610,
    "idp": "Google",
    "name": "MURAT AKKAÅž",
    "preferred_username": "4405b296-a304-436e-ad3f-739afefa4931",
    "amr": "external"
  }
}
2018-06-07 01:57:17.571 +03:00 [INF] End session request validation success
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "SubjectId": "unknown",
  "PostLogOutUri": "http://localhost:4200",
  "Raw": {
    "id_token_hint": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ4YjhlNTE4ODNkMjc0NGJkZGQxNzdkZTRmZGE4Yjk1IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1MjgzMjU2MTMsImV4cCI6MTUyODMyNTkxMywiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDAwIiwiYXVkIjoiZGV3cy53ZWIiLCJub25jZSI6Ik4wLjAxMzY2NzIxMjUzOTAxNTM3MjE1MjgzMjU1OTM5ODciLCJpYXQiOjE1MjgzMjU2MTMsImF0X2hhc2giOiJkTzJIWDNsbmNtazB1aDZfRXJCQ25nIiwic2lkIjoiZTlkM2YxN2I1MTUxNjczOTcxMTZhMDZmZTIxY2EzZWYiLCJzdWIiOiJjNWUzNzBlNi03MjE4LTQ5ZDgtYTUyMC05ODdlNjM2OTdkNDMiLCJhdXRoX3RpbWUiOjE1MjgzMjU2MTAsImlkcCI6Ikdvb2dsZSIsIm5hbWUiOiJNVVJBVCBBS0tBxZ4iLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiI0NDA1YjI5Ni1hMzA0LTQzNmUtYWQzZi03MzlhZmVmYTQ5MzEiLCJhbXIiOlsiZXh0ZXJuYWwiXX0.ZjMCQVQWgg-CLysak66UWATQ51H8Xk-IU6pTTwFpdFBOgCPAS1mm-w59oiKFREqtS41OBQvprziGpYTxGKqqCtMzNr3yXaWaahwnZitxQbRZYWFwPjLfr-r_OBVQIzlYAfqS0QFTZlBhGTf8ppn5yCu0qBFQh8O9g0IlWa74hCa6SvIdRCIwR6deKUKG9NgGZy218uUqNp8eYE7_gUOLQn-du6mwXRV2mKkLIVUw8zlDUnQR32mry9UPPLAvgRJramTjLXmW76JZcN1XI9wBvGk4q9fKaKzYrf7uDa2C_rnhCg30J5ll_iAG5lbyqkb0TXZIIgi6QPLPV7xvBUWA3g",
    "post_logout_redirect_uri": "http://localhost:4200"
  }
}
2018-06-07 01:57:17.579 +03:00 [DBG] Success validating end session request from dews.web
2018-06-07 01:57:17.644 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:17.652 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:17.873 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:22.729 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:22.762 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:22.767 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 01:57:22.784 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 01:57:22.788 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 01:57:22.800 +03:00 [DBG] Start authorize request
2018-06-07 01:57:22.802 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:22.815 +03:00 [DBG] No user present in authorize request
2018-06-07 01:57:22.824 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:57:23.177 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:57:23.338 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:57:23.896 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:57:23.981 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:57:24.179 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:57:24.199 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:57:24.219 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.279222064608029451528325842686",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.279222064608029451528325842686",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 01:57:24.247 +03:00 [INF] Showing login: User is not authenticated
2018-06-07 01:57:24.265 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:24.268 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:24.332 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:24.336 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:57:24.805 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:57:24.892 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:57:25.105 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:57:25.202 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:57:25.448 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:57:25.452 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:57:25.904 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:57:26.758 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {5d3f8124-a479-4abe-a901-6419f07568ca} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-07 01:57:29.094 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:29.116 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:29.221 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-07 01:57:35.560 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-07 01:57:35.576 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:35.580 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:35.667 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-07 01:57:36.166 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEC038H1C9K:00000008",
  "TimeStamp": "2018-06-06T22:57:36Z",
  "ProcessId": 53080,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 01:57:36.187 +03:00 [DBG] Augmenting SignInContext
2018-06-07 01:57:36.192 +03:00 [DBG] Adding amr claim with value: external
2018-06-07 01:57:36.199 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:57:36.205 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 01:57:36.216 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-07 01:57:36.239 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:57:36.243 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 01:57:36.245 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-07 01:57:36.255 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-07 01:57:36.259 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-07 01:57:36.273 +03:00 [DBG] Start authorize callback request
2018-06-07 01:57:36.285 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 01:57:36.288 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 01:57:37.150 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:57:37.316 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:57:37.903 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:57:38.098 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:57:38.515 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 01:57:38.522 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 01:57:38.526 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.279222064608029451528325842686",
  "SessionId": "ea84888cc1dcdc1ceede3fbd275810f1",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.279222064608029451528325842686",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 01:57:38.794 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-07 01:57:38.832 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-07 01:57:38.851 +03:00 [DBG] Creating Implicit Flow response.
2018-06-07 01:57:38.871 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-07 01:57:38.874 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 01:57:39.078 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-07 01:57:39.219 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****ZMWw"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****zbCg"
    }
  ],
  "ActivityId": "0HLEC038H1C9K:00000009",
  "TimeStamp": "2018-06-06T22:57:39Z",
  "ProcessId": 53080,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 01:57:39.240 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15283217129500.40261816078851753",
  "Scope": "openid profile dews.api"
}
2018-06-07 01:57:39.288 +03:00 [DBG] Augmenting SignInContext
2018-06-07 01:57:39.292 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 01:57:42.394 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-07 01:57:42.453 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 01:57:42.457 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 01:57:42.467 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:57:42.479 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:57:42.483 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:57:42.495 +03:00 [DBG] Start key discovery request
2018-06-07 01:57:42.717 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-07 01:57:42.751 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 01:57:42.755 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 01:57:42.763 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-07 01:57:42.768 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-07 01:57:42.771 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-07 01:57:42.793 +03:00 [DBG] Start userinfo request
2018-06-07 01:57:42.800 +03:00 [DBG] Bearer token found in header
2018-06-07 01:57:43.165 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:57:43.505 +03:00 [DBG] dews.web found in database: true
2018-06-07 01:57:43.551 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-07 01:57:43.556 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528325859,
    "exp": 1528329459,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528325856,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-07 01:57:43.572 +03:00 [DBG] Creating userinfo response
2018-06-07 01:57:43.582 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:57:43.589 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:57:43.694 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:57:43.706 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-07 01:57:43.718 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 01:57:43.789 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 01:57:43.899 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-07 01:57:43.905 +03:00 [DBG] End userinfo request
2018-06-07 01:57:44.763 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 01:57:44.771 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 01:57:44.787 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 01:57:44.806 +03:00 [DBG] Start discovery request
2018-06-07 01:57:45.195 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 01:57:45.499 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:57:45.507 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:57:45.515 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:57:45.520 +03:00 [DBG] Start key discovery request
2018-06-07 01:58:50.135 +03:00 [WRN] No XML encryptor configured. Key "784e6e90-8b80-4d2c-bf01-cd4fb8740c5e" may be persisted to storage in unencrypted form.
2018-06-07 01:58:50.420 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 01:58:50.428 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 01:58:50.430 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 01:58:50.432 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 01:58:50.434 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 01:58:50.676 +03:00 [DBG] Starting token cleanup
2018-06-07 01:58:51.922 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:58:51.984 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 01:59:08.569 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 01:59:08.582 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 01:59:08.585 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 01:59:08.597 +03:00 [DBG] Start discovery request
2018-06-07 01:59:10.068 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 01:59:10.545 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 01:59:10.550 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 01:59:10.554 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 01:59:10.564 +03:00 [DBG] Start key discovery request
2018-06-07 02:02:48.404 +03:00 [WRN] No XML encryptor configured. Key "7cbb69e1-1758-4aa5-a4ab-4400dc4027b7" may be persisted to storage in unencrypted form.
2018-06-07 02:02:48.798 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 02:02:48.810 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 02:02:48.813 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 02:02:48.815 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 02:02:48.818 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 02:02:49.102 +03:00 [DBG] Starting token cleanup
2018-06-07 02:02:50.703 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:02:50.754 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:03:07.172 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 02:03:07.184 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 02:03:07.188 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 02:03:07.197 +03:00 [DBG] Start discovery request
2018-06-07 02:03:08.506 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 02:03:08.952 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 02:03:08.958 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 02:03:08.963 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 02:03:08.970 +03:00 [DBG] Start key discovery request
2018-06-07 02:04:41.744 +03:00 [WRN] No XML encryptor configured. Key "d8b3f6b3-79a4-4a9f-b300-6925bc2c21b5" may be persisted to storage in unencrypted form.
2018-06-07 02:04:42.123 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 02:04:42.138 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 02:04:42.141 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 02:04:42.143 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 02:04:42.147 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 02:04:42.394 +03:00 [DBG] Starting token cleanup
2018-06-07 02:04:43.887 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:04:43.926 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:04:49.827 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:04:49.839 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:04:49.856 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 02:04:49.874 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 02:04:49.880 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 02:04:49.891 +03:00 [DBG] Start authorize request
2018-06-07 02:04:49.903 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:04:49.917 +03:00 [DBG] No user present in authorize request
2018-06-07 02:04:49.935 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 02:04:51.917 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:04:52.099 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:04:52.668 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:04:52.798 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:04:52.975 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:04:52.993 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 02:04:53.109 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.318349185111130641528326289808",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.318349185111130641528326289808",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 02:04:53.130 +03:00 [INF] Showing login: User is not authenticated
2018-06-07 02:04:53.161 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:04:53.165 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:04:53.316 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:04:53.320 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 02:04:53.823 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:04:53.908 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:04:54.179 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:04:54.290 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:04:54.547 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:04:54.552 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 02:04:54.974 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:04:55.873 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {88c99e32-07b8-43c4-9041-414ae341a3c8} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-07 02:04:57.812 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:04:57.819 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:04:57.877 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-07 02:05:02.712 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-07 02:05:02.742 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:05:02.747 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:05:02.880 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-07 02:05:03.562 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEC07HMC2IV:00000006",
  "TimeStamp": "2018-06-06T23:05:03Z",
  "ProcessId": 26012,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 02:05:03.586 +03:00 [DBG] Augmenting SignInContext
2018-06-07 02:05:03.591 +03:00 [DBG] Adding amr claim with value: external
2018-06-07 02:05:03.601 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:05:03.614 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 02:05:03.635 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-07 02:05:03.667 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 02:05:03.672 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 02:05:03.677 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-07 02:05:03.686 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-07 02:05:03.689 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-07 02:05:03.702 +03:00 [DBG] Start authorize callback request
2018-06-07 02:05:03.712 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 02:05:03.717 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 02:05:04.620 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:05:04.806 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:05:05.271 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:05:05.469 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:05:06.004 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:05:06.008 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 02:05:06.012 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.318349185111130641528326289808",
  "SessionId": "df826d4eddbe913b43e4f6fcb933e732",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.318349185111130641528326289808",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 02:05:06.247 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-07 02:05:06.285 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-07 02:05:06.303 +03:00 [DBG] Creating Implicit Flow response.
2018-06-07 02:05:06.320 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-07 02:05:06.325 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 02:05:06.577 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-07 02:05:06.699 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****RtlQ"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****VrWg"
    }
  ],
  "ActivityId": "0HLEC07HMC2IV:00000007",
  "TimeStamp": "2018-06-06T23:05:06Z",
  "ProcessId": 26012,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 02:05:06.713 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15283217129500.40261816078851753",
  "Scope": "openid profile dews.api"
}
2018-06-07 02:05:06.751 +03:00 [DBG] Augmenting SignInContext
2018-06-07 02:05:06.755 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 02:05:09.666 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-07 02:05:09.737 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 02:05:09.744 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 02:05:09.758 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 02:05:09.781 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 02:05:09.796 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 02:05:09.816 +03:00 [DBG] Start key discovery request
2018-06-07 02:05:10.083 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-07 02:05:10.118 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 02:05:10.121 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 02:05:10.126 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-07 02:05:10.132 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-07 02:05:10.134 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-07 02:05:10.147 +03:00 [DBG] Start userinfo request
2018-06-07 02:05:10.153 +03:00 [DBG] Bearer token found in header
2018-06-07 02:05:10.679 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:05:11.086 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:05:11.159 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-07 02:05:11.172 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528326306,
    "exp": 1528329906,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528326303,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-07 02:05:11.185 +03:00 [DBG] Creating userinfo response
2018-06-07 02:05:11.193 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 02:05:11.199 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 02:05:11.264 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:05:11.270 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-07 02:05:11.273 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 02:05:11.347 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:05:11.450 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-07 02:05:11.454 +03:00 [DBG] End userinfo request
2018-06-07 02:06:17.675 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 02:06:17.684 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 02:06:17.691 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 02:06:17.701 +03:00 [DBG] Start discovery request
2018-06-07 02:06:18.056 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 02:06:18.507 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 02:06:18.510 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 02:06:18.513 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 02:06:18.516 +03:00 [DBG] Start key discovery request
2018-06-07 02:10:07.176 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 02:10:07.200 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 02:10:07.204 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 02:10:07.217 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 02:10:07.220 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 02:10:07.224 +03:00 [DBG] Start authorize request
2018-06-07 02:10:07.227 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 02:10:07.230 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 02:10:07.596 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:10:07.606 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.77651081896449871528326607104",
    "state": "15283217129500.40261816078851753",
    "prompt": "none"
  }
}
2018-06-07 02:10:07.620 +03:00 [ERR] Request validation failed
2018-06-07 02:10:07.623 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.77651081896449871528326607104",
    "state": "15283217129500.40261816078851753",
    "prompt": "none"
  }
}
2018-06-07 02:10:07.640 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEC07HMC2J6:00000001",
  "TimeStamp": "2018-06-06T23:10:07Z",
  "ProcessId": 26012,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 02:10:07.673 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 02:10:07.676 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 02:17:50.230 +03:00 [WRN] No XML encryptor configured. Key "cf397754-7aec-483e-a8b6-f27da764739d" may be persisted to storage in unencrypted form.
2018-06-07 02:17:50.502 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 02:17:50.509 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 02:17:50.511 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 02:17:50.513 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 02:17:50.514 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 02:17:50.716 +03:00 [DBG] Starting token cleanup
2018-06-07 02:17:51.561 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:17:51.586 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:17:59.677 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:17:59.681 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:17:59.692 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 02:17:59.702 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 02:17:59.705 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 02:17:59.711 +03:00 [DBG] Start authorize request
2018-06-07 02:17:59.719 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:17:59.727 +03:00 [DBG] No user present in authorize request
2018-06-07 02:17:59.742 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 02:18:01.174 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:18:01.305 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:18:01.635 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:18:01.709 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:18:01.818 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:18:01.830 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 02:18:01.905 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.138567869164431651528327079665",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.138567869164431651528327079665",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 02:18:01.918 +03:00 [INF] Showing login: User is not authenticated
2018-06-07 02:18:01.937 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:18:01.940 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:18:02.030 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:18:02.034 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 02:18:02.393 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:18:02.466 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:18:02.644 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:18:02.719 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:18:02.901 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:18:02.904 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 02:18:03.255 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:18:03.869 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {d8b3f6b3-79a4-4a9f-b300-6925bc2c21b5} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-07 02:18:06.364 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:18:06.370 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:18:06.414 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-07 02:18:10.927 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-07 02:18:10.937 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:18:10.940 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:18:11.010 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-07 02:18:11.509 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEC0ESJO415:00000006",
  "TimeStamp": "2018-06-06T23:18:11Z",
  "ProcessId": 6908,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 02:18:11.524 +03:00 [DBG] Augmenting SignInContext
2018-06-07 02:18:11.529 +03:00 [DBG] Adding amr claim with value: external
2018-06-07 02:18:11.535 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:18:11.543 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 02:18:11.550 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-07 02:18:11.567 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 02:18:11.569 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 02:18:11.572 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-07 02:18:11.577 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-07 02:18:11.579 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-07 02:18:11.586 +03:00 [DBG] Start authorize callback request
2018-06-07 02:18:11.594 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 02:18:11.596 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 02:18:12.190 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:18:12.317 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:18:12.614 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:18:12.733 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:18:13.060 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:18:13.063 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 02:18:13.066 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.138567869164431651528327079665",
  "SessionId": "d5a51f7438cc7b54ff1b0cc1e0ff8841",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.138567869164431651528327079665",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 02:18:13.270 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-07 02:18:13.291 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-07 02:18:13.301 +03:00 [DBG] Creating Implicit Flow response.
2018-06-07 02:18:13.313 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-07 02:18:13.316 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 02:18:13.524 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-07 02:18:13.632 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****yYGA"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****MNQw"
    }
  ],
  "ActivityId": "0HLEC0ESJO415:00000007",
  "TimeStamp": "2018-06-06T23:18:13Z",
  "ProcessId": 6908,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 02:18:13.644 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15283217129500.40261816078851753",
  "Scope": "openid profile dews.api"
}
2018-06-07 02:18:13.668 +03:00 [DBG] Augmenting SignInContext
2018-06-07 02:18:13.670 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 02:18:16.460 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-07 02:18:16.522 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 02:18:16.525 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 02:18:16.541 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 02:18:16.551 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 02:18:16.583 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 02:18:16.611 +03:00 [DBG] Start key discovery request
2018-06-07 02:18:16.947 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-07 02:18:16.992 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 02:18:16.995 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 02:18:16.999 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-07 02:18:17.008 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-07 02:18:17.010 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-07 02:18:17.019 +03:00 [DBG] Start userinfo request
2018-06-07 02:18:17.028 +03:00 [DBG] Bearer token found in header
2018-06-07 02:18:17.388 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:18:17.623 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:18:17.656 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-07 02:18:17.664 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528327093,
    "exp": 1528330693,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528327091,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-07 02:18:17.674 +03:00 [DBG] Creating userinfo response
2018-06-07 02:18:17.679 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 02:18:17.683 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 02:18:17.733 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:18:17.738 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-07 02:18:17.740 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 02:18:17.774 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:18:17.856 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-07 02:18:17.860 +03:00 [DBG] End userinfo request
2018-06-07 02:18:54.147 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 02:18:54.151 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 02:18:54.154 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 02:18:54.166 +03:00 [DBG] Start discovery request
2018-06-07 02:18:54.434 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 02:18:54.504 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 02:18:54.510 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 02:18:54.513 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 02:18:54.515 +03:00 [DBG] Start key discovery request
2018-06-07 02:20:58.692 +03:00 [WRN] No XML encryptor configured. Key "7b1cdf1d-744f-4133-acab-937e93d59d9d" may be persisted to storage in unencrypted form.
2018-06-07 02:20:59.009 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 02:20:59.015 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 02:20:59.017 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 02:20:59.019 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 02:20:59.021 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 02:20:59.181 +03:00 [DBG] Starting token cleanup
2018-06-07 02:21:00.262 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:00.281 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:00.382 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:00.397 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:04.663 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:04.673 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:04.691 +03:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2018-06-07 02:21:04.707 +03:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2018-06-07 02:21:04.709 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2018-06-07 02:21:04.731 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:04.736 +03:00 [DBG] Processing signout request for anonymous
2018-06-07 02:21:04.742 +03:00 [DBG] Start end session request validation
2018-06-07 02:21:04.757 +03:00 [DBG] Start identity token validation
2018-06-07 02:21:05.636 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:05.640 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:05.642 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-07 02:21:05.651 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-07 02:21:05.653 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-07 02:21:05.681 +03:00 [DBG] Start authorize request
2018-06-07 02:21:05.684 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:05.708 +03:00 [DBG] No user present in authorize request
2018-06-07 02:21:05.719 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 02:21:06.532 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:21:06.532 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:21:06.536 +03:00 [DBG] Client found: dews.web / Developer News
2018-06-07 02:21:06.671 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:21:06.839 +03:00 [INF] {
  "Name": "Unhandled Exception",
  "Category": "Error",
  "EventType": "Error",
  "Id": 3000,
  "Details": "System.OperationCanceledException: The operation was canceled.\r\n   at System.Threading.CancellationToken.ThrowOperationCanceledException()\r\n   at Microsoft.AspNetCore.Identity.EntityFrameworkCore.UserStore`9.FindByIdAsync(String userId, CancellationToken cancellationToken)\r\n   at Microsoft.AspNetCore.Identity.UserManager`1.FindByIdAsync(String userId)\r\n   at IdentityServer4.AspNetIdentity.ProfileService`1.<IsActiveAsync>d__4.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at IdentityServer4.Validation.TokenValidator.<ValidateIdentityTokenAsync>d__12.MoveNext() in C:\\local\\identity\\server4\\IdentityServer4\\src\\IdentityServer4\\Validation\\TokenValidator.cs:line 121\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at IdentityServer4.Validation.EndSessionRequestValidator.<ValidateAsync>d__9.MoveNext() in C:\\local\\identity\\server4\\IdentityServer4\\src\\IdentityServer4\\Validation\\EndSessionRequestValidator.cs:line 74\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at IdentityServer4.Endpoints.EndSessionEndpoint.<ProcessAsync>d__4.MoveNext() in C:\\local\\identity\\server4\\IdentityServer4\\src\\IdentityServer4\\Endpoints\\EndSessionEndpoint.cs:line 56\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\\local\\identity\\server4\\IdentityServer4\\src\\IdentityServer4\\Hosting\\IdentityServerMiddleware.cs:line 54",
  "Message": "The operation was canceled.",
  "ActivityId": "0HLEC0GKRV3VJ:00000007",
  "TimeStamp": "2018-06-06T23:21:06Z",
  "ProcessId": 15784,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 02:21:06.886 +03:00 [FTL] Unhandled exception: System.OperationCanceledException: The operation was canceled.
   at System.Threading.CancellationToken.ThrowOperationCanceledException()
   at Microsoft.AspNetCore.Identity.EntityFrameworkCore.UserStore`9.FindByIdAsync(String userId, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Identity.UserManager`1.FindByIdAsync(String userId)
   at IdentityServer4.AspNetIdentity.ProfileService`1.<IsActiveAsync>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Validation.TokenValidator.<ValidateIdentityTokenAsync>d__12.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Validation\TokenValidator.cs:line 121
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Validation.EndSessionRequestValidator.<ValidateAsync>d__9.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Validation\EndSessionRequestValidator.cs:line 74
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Endpoints.EndSessionEndpoint.<ProcessAsync>d__4.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Endpoints\EndSessionEndpoint.cs:line 56
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 54
2018-06-07 02:21:06.903 +03:00 [ERR] An unhandled exception has occurred while executing the request
System.OperationCanceledException: The operation was canceled.
   at System.Threading.CancellationToken.ThrowOperationCanceledException()
   at Microsoft.AspNetCore.Identity.EntityFrameworkCore.UserStore`9.FindByIdAsync(String userId, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Identity.UserManager`1.FindByIdAsync(String userId)
   at IdentityServer4.AspNetIdentity.ProfileService`1.<IsActiveAsync>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Validation.TokenValidator.<ValidateIdentityTokenAsync>d__12.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Validation\TokenValidator.cs:line 121
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Validation.EndSessionRequestValidator.<ValidateAsync>d__9.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Validation\EndSessionRequestValidator.cs:line 74
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Endpoints.EndSessionEndpoint.<ProcessAsync>d__4.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Endpoints\EndSessionEndpoint.cs:line 56
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 54
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at IdentityServer4.Hosting.IdentityServerMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\IdentityServerMiddleware.cs:line 72
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware.<Invoke>d__7.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at IdentityServer4.Hosting.BaseUrlMiddleware.<Invoke>d__3.MoveNext() in C:\local\identity\server4\IdentityServer4\src\IdentityServer4\Hosting\BaseUrlMiddleware.cs:line 43
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.MigrationsEndPointMiddleware.<Invoke>d__4.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore.DatabaseErrorPageMiddleware.<Invoke>d__6.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.<Invoke>d__7.MoveNext()
2018-06-07 02:21:07.175 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:21:07.241 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:21:07.355 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:21:07.370 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 02:21:07.399 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.305797081722289031528327265617",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.305797081722289031528327265617",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 02:21:07.409 +03:00 [INF] Showing login: User is not authenticated
2018-06-07 02:21:07.424 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:07.426 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:07.520 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:07.523 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 02:21:07.865 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:21:07.934 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:21:08.096 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:21:08.170 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:21:08.355 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:21:08.357 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 02:21:08.635 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:21:09.234 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {cf397754-7aec-483e-a8b6-f27da764739d} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-07 02:21:11.085 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:11.089 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:11.141 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-07 02:21:14.996 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-07 02:21:15.007 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:15.010 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:15.070 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-07 02:21:15.485 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEC0GKRV3VI:00000007",
  "TimeStamp": "2018-06-06T23:21:15Z",
  "ProcessId": 15784,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 02:21:15.498 +03:00 [DBG] Augmenting SignInContext
2018-06-07 02:21:15.502 +03:00 [DBG] Adding amr claim with value: external
2018-06-07 02:21:15.507 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:21:15.511 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 02:21:15.518 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-07 02:21:15.535 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 02:21:15.538 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-07 02:21:15.542 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-07 02:21:15.545 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-07 02:21:15.548 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-07 02:21:15.556 +03:00 [DBG] Start authorize callback request
2018-06-07 02:21:15.563 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 02:21:15.565 +03:00 [DBG] Start authorize request protocol validation
2018-06-07 02:21:15.804 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:21:15.851 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:21:15.969 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:21:16.019 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:21:16.134 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-07 02:21:16.137 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-07 02:21:16.140 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15283217129500.40261816078851753",
  "Nonce": "N0.305797081722289031528327265617",
  "SessionId": "57744430e0d406b33d731798cdf516a6",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.305797081722289031528327265617",
    "state": "15283217129500.40261816078851753"
  }
}
2018-06-07 02:21:16.266 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-07 02:21:16.283 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-07 02:21:16.294 +03:00 [DBG] Creating Implicit Flow response.
2018-06-07 02:21:16.306 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-07 02:21:16.309 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-07 02:21:16.418 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-07 02:21:16.497 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****-D0A"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****XhqA"
    }
  ],
  "ActivityId": "0HLEC0GKRV3VI:00000008",
  "TimeStamp": "2018-06-06T23:21:16Z",
  "ProcessId": 15784,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-07 02:21:16.507 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15283217129500.40261816078851753",
  "Scope": "openid profile dews.api"
}
2018-06-07 02:21:16.530 +03:00 [DBG] Augmenting SignInContext
2018-06-07 02:21:16.532 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-07 02:21:18.529 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-07 02:21:18.575 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 02:21:18.579 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 02:21:18.585 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 02:21:18.600 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 02:21:18.602 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 02:21:18.611 +03:00 [DBG] Start key discovery request
2018-06-07 02:21:18.765 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-07 02:21:18.793 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-07 02:21:18.796 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-07 02:21:18.800 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-07 02:21:18.805 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-07 02:21:18.808 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-07 02:21:18.817 +03:00 [DBG] Start userinfo request
2018-06-07 02:21:18.824 +03:00 [DBG] Bearer token found in header
2018-06-07 02:21:19.085 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:21:19.321 +03:00 [DBG] dews.web found in database: true
2018-06-07 02:21:19.355 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-07 02:21:19.364 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528327276,
    "exp": 1528330876,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528327275,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-07 02:21:19.375 +03:00 [DBG] Creating userinfo response
2018-06-07 02:21:19.381 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 02:21:19.387 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 02:21:19.428 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:21:19.433 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-07 02:21:19.435 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-07 02:21:19.488 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-07 02:21:19.550 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-07 02:21:19.555 +03:00 [DBG] End userinfo request
2018-06-07 02:21:19.957 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 02:21:19.961 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 02:21:19.964 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 02:21:19.974 +03:00 [DBG] Start discovery request
2018-06-07 02:21:20.214 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 02:21:20.398 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 02:21:20.401 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 02:21:20.406 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 02:21:20.409 +03:00 [DBG] Start key discovery request
2018-06-07 02:22:29.148 +03:00 [WRN] No XML encryptor configured. Key "c734322c-f246-4229-a7d5-ca15628b0022" may be persisted to storage in unencrypted form.
2018-06-07 02:22:29.373 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-07 02:22:29.379 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-07 02:22:29.381 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-07 02:22:29.382 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-07 02:22:29.384 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-07 02:22:29.546 +03:00 [DBG] Starting token cleanup
2018-06-07 02:22:30.501 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:22:30.531 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-07 02:22:54.420 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-07 02:22:54.436 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-07 02:22:54.438 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-07 02:22:54.443 +03:00 [DBG] Start discovery request
2018-06-07 02:22:55.488 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-07 02:22:55.806 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-07 02:22:55.810 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-07 02:22:55.812 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-07 02:22:55.819 +03:00 [DBG] Start key discovery request
2018-06-08 13:07:46.744 +03:00 [WRN] No XML encryptor configured. Key "b9aa8fb7-9662-4f5e-b463-33bde0c810c9" may be persisted to storage in unencrypted form.
2018-06-08 13:07:47.081 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-08 13:07:47.088 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-08 13:07:47.090 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-08 13:07:47.093 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-08 13:07:47.095 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-08 13:07:47.300 +03:00 [DBG] Starting token cleanup
2018-06-09 16:26:45.415 +03:00 [WRN] No XML encryptor configured. Key "b2ab9846-185c-42d6-af32-a7fa94787af5" may be persisted to storage in unencrypted form.
2018-06-09 16:26:45.893 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-09 16:26:45.906 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-09 16:26:45.911 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-09 16:26:45.913 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-09 16:26:45.916 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-09 16:26:46.216 +03:00 [DBG] Starting token cleanup
2018-06-09 16:35:15.511 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 16:35:15.547 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 16:35:15.550 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 16:35:15.573 +03:00 [DBG] Start authorize request
2018-06-09 16:35:15.596 +03:00 [DBG] No user present in authorize request
2018-06-09 16:35:15.614 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 16:35:17.175 +03:00 [DBG] dews.web found in database: true
2018-06-09 16:35:17.298 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:35:17.652 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 16:35:17.681 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:35:17.706 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 16:35:17.724 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 16:35:17.817 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.132294293580244471528551315411",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.132294293580244471528551315411",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 16:35:17.834 +03:00 [INF] Showing login: User is not authenticated
2018-06-09 16:35:17.952 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 16:35:17.993 +03:00 [DBG] dews.web found in database: true
2018-06-09 16:35:18.003 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:35:18.028 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 16:35:18.042 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:35:18.068 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 16:35:18.074 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 16:35:18.134 +03:00 [DBG] dews.web found in database: true
2018-06-09 16:35:20.861 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-09 16:35:40.043 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-09 16:35:40.079 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-09 16:35:40.489 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEE1IJ2HBE7:00000005",
  "TimeStamp": "2018-06-09T13:35:40Z",
  "ProcessId": 12200,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 16:35:40.508 +03:00 [DBG] Augmenting SignInContext
2018-06-09 16:35:40.512 +03:00 [DBG] Adding amr claim with value: external
2018-06-09 16:35:40.524 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-09 16:35:40.533 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-09 16:35:40.555 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 16:35:40.559 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 16:35:40.563 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-09 16:35:40.570 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-09 16:35:40.574 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-09 16:35:40.596 +03:00 [DBG] Start authorize callback request
2018-06-09 16:35:40.608 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 16:35:40.611 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 16:35:40.695 +03:00 [DBG] dews.web found in database: true
2018-06-09 16:35:40.715 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:35:40.864 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 16:35:40.877 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:35:40.903 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 16:35:40.908 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 16:35:40.911 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.132294293580244471528551315411",
  "SessionId": "ec82d4b90388ccd8e48acefbef5809a5",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.132294293580244471528551315411",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 16:35:41.031 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 16:35:41.061 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 16:35:41.074 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 16:35:41.092 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 16:35:41.096 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 16:35:41.260 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 16:35:41.304 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****MdWQ"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****wF4A"
    }
  ],
  "ActivityId": "0HLEE1IJ2HBE7:00000006",
  "TimeStamp": "2018-06-09T13:35:41Z",
  "ProcessId": 12200,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 16:35:41.314 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 16:35:41.343 +03:00 [DBG] Augmenting SignInContext
2018-06-09 16:35:41.346 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-09 16:35:44.954 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 16:35:44.986 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 16:35:44.991 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 16:35:44.998 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 16:35:45.005 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 16:35:45.008 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 16:35:45.018 +03:00 [DBG] Start key discovery request
2018-06-09 16:35:45.308 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 16:35:45.320 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 16:35:45.323 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 16:35:45.329 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 16:35:45.341 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 16:35:45.347 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 16:35:45.360 +03:00 [DBG] Start userinfo request
2018-06-09 16:35:45.376 +03:00 [DBG] Bearer token found in header
2018-06-09 16:35:45.490 +03:00 [DBG] dews.web found in database: true
2018-06-09 16:35:45.527 +03:00 [DBG] dews.web found in database: true
2018-06-09 16:35:45.543 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 16:35:45.557 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528551341,
    "exp": 1528554941,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528551340,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 16:35:45.583 +03:00 [DBG] Creating userinfo response
2018-06-09 16:35:45.602 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 16:35:45.610 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 16:35:45.624 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:35:45.628 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 16:35:45.632 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 16:35:45.642 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:35:45.657 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 16:35:45.661 +03:00 [DBG] End userinfo request
2018-06-09 16:36:00.318 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-09 16:36:00.324 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-09 16:36:00.328 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-09 16:36:00.336 +03:00 [DBG] Start discovery request
2018-06-09 16:36:00.481 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-09 16:36:00.734 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 16:36:00.751 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 16:36:00.758 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 16:36:00.763 +03:00 [DBG] Start key discovery request
2018-06-09 16:36:21.693 +03:00 [WRN] Heartbeat took longer than ""00:00:01"" at ""2018-06-09T13:36:21.6659309+00:00"".
2018-06-09 16:40:41.445 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 16:40:41.467 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 16:40:41.473 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 16:40:41.483 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 16:40:41.497 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 16:40:41.503 +03:00 [DBG] Start authorize request
2018-06-09 16:40:41.506 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 16:40:41.513 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 16:40:41.594 +03:00 [DBG] dews.web found in database: true
2018-06-09 16:40:41.599 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.017714748744811271528551641432",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 16:40:41.606 +03:00 [ERR] Request validation failed
2018-06-09 16:40:41.608 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.017714748744811271528551641432",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 16:40:41.630 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEE1IJ2HBEC:00000001",
  "TimeStamp": "2018-06-09T13:40:41Z",
  "ProcessId": 12200,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 16:40:41.654 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 16:40:41.657 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 16:44:21.440 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 16:44:21.447 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 16:44:21.450 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 16:44:21.453 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 16:44:21.456 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 16:44:21.460 +03:00 [DBG] Start authorize request
2018-06-09 16:44:21.463 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 16:44:21.467 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 16:44:21.527 +03:00 [DBG] dews.web found in database: true
2018-06-09 16:44:21.543 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:44:21.665 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 16:44:21.677 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:44:21.699 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 16:44:21.703 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 16:44:21.706 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.3985060803711141528551861429",
  "SessionId": "ec82d4b90388ccd8e48acefbef5809a5",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.3985060803711141528551861429",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 16:44:21.731 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 16:44:21.740 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 16:44:21.744 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 16:44:21.748 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 16:44:21.751 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 16:44:21.781 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 16:44:21.802 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****PDIw"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****vVcw"
    }
  ],
  "ActivityId": "0HLEE1IJ2HBEC:00000003",
  "TimeStamp": "2018-06-09T13:44:21Z",
  "ProcessId": 12200,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 16:44:21.810 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 16:44:23.866 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 16:44:23.881 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 16:44:23.884 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 16:44:23.893 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 16:44:23.897 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 16:44:23.900 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 16:44:23.903 +03:00 [DBG] Start key discovery request
2018-06-09 16:44:24.085 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 16:44:24.099 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 16:44:24.103 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 16:44:24.108 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 16:44:24.113 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 16:44:24.116 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 16:44:24.122 +03:00 [DBG] Start userinfo request
2018-06-09 16:44:24.129 +03:00 [DBG] Bearer token found in header
2018-06-09 16:44:24.178 +03:00 [DBG] dews.web found in database: true
2018-06-09 16:44:24.208 +03:00 [DBG] dews.web found in database: true
2018-06-09 16:44:24.221 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 16:44:24.231 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528551861,
    "exp": 1528555461,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528551340,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 16:44:24.236 +03:00 [DBG] Creating userinfo response
2018-06-09 16:44:24.239 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 16:44:24.242 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 16:44:24.251 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:44:24.254 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 16:44:24.257 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 16:44:24.267 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 16:44:24.285 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 16:44:24.287 +03:00 [DBG] End userinfo request
2018-06-09 16:48:22.093 +03:00 [WRN] No XML encryptor configured. Key "643a5f85-bcc2-417b-9794-837042094774" may be persisted to storage in unencrypted form.
2018-06-09 16:48:22.474 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-09 16:48:22.483 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-09 16:48:22.486 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-09 16:48:22.488 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-09 16:48:22.491 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-09 16:48:22.744 +03:00 [DBG] Starting token cleanup
2018-06-09 16:48:24.079 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 16:48:24.116 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 16:49:22.221 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 16:49:22.274 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 16:49:22.294 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 16:49:22.314 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 16:49:22.320 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 16:49:22.339 +03:00 [DBG] Start authorize request
2018-06-09 16:49:22.352 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 16:49:22.362 +03:00 [DBG] No user present in authorize request
2018-06-09 16:49:22.379 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 16:49:23.628 +03:00 [DBG] dews.web found in database: true
2018-06-09 16:49:23.709 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.39971574300659851528552162214",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 16:49:23.718 +03:00 [ERR] Request validation failed
2018-06-09 16:49:23.721 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.39971574300659851528552162214",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 16:49:23.796 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEE1ULCQ8EQ:00000002",
  "TimeStamp": "2018-06-09T13:49:23Z",
  "ProcessId": 52232,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 16:49:23.835 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 16:49:23.839 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:44.885 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:44.892 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:44.895 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 17:26:44.899 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 17:26:44.913 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 17:26:44.917 +03:00 [DBG] Start authorize request
2018-06-09 17:26:44.921 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:44.926 +03:00 [DBG] No user present in authorize request
2018-06-09 17:26:44.929 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 17:26:45.047 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:26:45.141 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:26:45.526 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:26:45.556 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:26:45.579 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:26:45.607 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 17:26:45.612 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.68377095225026821528554404873",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.68377095225026821528554404873",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 17:26:45.627 +03:00 [INF] Showing login: User is not authenticated
2018-06-09 17:26:45.643 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:45.646 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:45.686 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:45.691 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 17:26:45.727 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:26:45.736 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:26:45.757 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:26:45.767 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:26:45.791 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:26:45.795 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 17:26:45.841 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:26:46.771 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {b2ab9846-185c-42d6-af32-a7fa94787af5} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-09 17:26:48.314 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:48.320 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:48.347 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-09 17:26:53.190 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-09 17:26:53.205 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:53.209 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:53.233 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-09 17:26:53.538 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEE1ULCQ8EU:00000005",
  "TimeStamp": "2018-06-09T14:26:53Z",
  "ProcessId": 52232,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 17:26:53.556 +03:00 [DBG] Augmenting SignInContext
2018-06-09 17:26:53.560 +03:00 [DBG] Adding amr claim with value: external
2018-06-09 17:26:53.569 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 17:26:53.576 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-09 17:26:53.589 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-09 17:26:53.613 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:26:53.619 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:26:53.623 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-09 17:26:53.628 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-09 17:26:53.633 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-09 17:26:53.645 +03:00 [DBG] Start authorize callback request
2018-06-09 17:26:53.654 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:26:53.658 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 17:26:53.737 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:26:53.754 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:26:53.866 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:26:53.878 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:26:53.907 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:26:53.915 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 17:26:53.920 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.68377095225026821528554404873",
  "SessionId": "2cf7fc929e52369f7b7c6f77b012932b",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.68377095225026821528554404873",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 17:26:54.032 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 17:26:54.063 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 17:26:54.083 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 17:26:54.107 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 17:26:54.113 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:26:54.242 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 17:26:54.285 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****kSWQ"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****QjeA"
    }
  ],
  "ActivityId": "0HLEE1ULCQ8EU:00000006",
  "TimeStamp": "2018-06-09T14:26:54Z",
  "ProcessId": 52232,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 17:26:54.297 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 17:26:54.327 +03:00 [DBG] Augmenting SignInContext
2018-06-09 17:26:54.337 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-09 17:26:58.646 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 17:26:58.672 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 17:26:58.676 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 17:26:58.684 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 17:26:58.691 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 17:26:58.696 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 17:26:58.705 +03:00 [DBG] Start key discovery request
2018-06-09 17:26:59.050 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 17:26:59.063 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 17:26:59.066 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 17:26:59.071 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 17:26:59.085 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 17:26:59.089 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 17:26:59.102 +03:00 [DBG] Start userinfo request
2018-06-09 17:26:59.112 +03:00 [DBG] Bearer token found in header
2018-06-09 17:26:59.246 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:26:59.278 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:26:59.290 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 17:26:59.302 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528554414,
    "exp": 1528558014,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528554413,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 17:26:59.314 +03:00 [DBG] Creating userinfo response
2018-06-09 17:26:59.321 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:26:59.328 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:26:59.339 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:26:59.343 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 17:26:59.346 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:26:59.355 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:26:59.370 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 17:26:59.374 +03:00 [DBG] End userinfo request
2018-06-09 17:27:01.365 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-09 17:27:01.371 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-09 17:27:01.375 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-09 17:27:01.385 +03:00 [DBG] Start discovery request
2018-06-09 17:27:01.519 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-09 17:27:01.692 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 17:27:01.697 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 17:27:01.701 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 17:27:01.706 +03:00 [DBG] Start key discovery request
2018-06-09 17:31:54.710 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:31:54.724 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:31:54.729 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 17:31:54.734 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 17:31:54.742 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 17:31:54.745 +03:00 [DBG] Start authorize request
2018-06-09 17:31:54.748 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:31:54.755 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 17:31:54.813 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:31:54.816 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.38150366733867361528554714594",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 17:31:54.822 +03:00 [ERR] Request validation failed
2018-06-09 17:31:54.824 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.38150366733867361528554714594",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 17:31:54.827 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEE1ULCQ8F1:00000001",
  "TimeStamp": "2018-06-09T14:31:54Z",
  "ProcessId": 52232,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 17:31:54.842 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:31:54.845 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:41:37.598 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:41:37.604 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:41:37.607 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 17:41:37.611 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 17:41:37.614 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 17:41:37.618 +03:00 [DBG] Start authorize request
2018-06-09 17:41:37.621 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:41:37.625 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 17:41:37.692 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:41:37.710 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:41:37.799 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:41:37.809 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:41:37.827 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:41:37.831 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 17:41:37.836 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.35895593654869161528555297424",
  "SessionId": "2cf7fc929e52369f7b7c6f77b012932b",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.35895593654869161528555297424",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 17:41:37.859 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 17:41:37.867 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 17:41:37.870 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 17:41:37.872 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 17:41:37.874 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:41:37.907 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 17:41:37.922 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****1UNg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****vq5Q"
    }
  ],
  "ActivityId": "0HLEE1ULCQ8F4:00000001",
  "TimeStamp": "2018-06-09T14:41:37Z",
  "ProcessId": 52232,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 17:41:37.925 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 17:41:41.470 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 17:41:41.481 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 17:41:41.484 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 17:41:41.489 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 17:41:41.492 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 17:41:41.495 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 17:41:41.500 +03:00 [DBG] Start key discovery request
2018-06-09 17:41:41.771 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 17:41:41.782 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 17:41:41.786 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 17:41:41.791 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 17:41:41.795 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 17:41:41.801 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 17:41:41.804 +03:00 [DBG] Start userinfo request
2018-06-09 17:41:41.807 +03:00 [DBG] Bearer token found in header
2018-06-09 17:41:41.842 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:41:41.917 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:41:41.926 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 17:41:41.931 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528555297,
    "exp": 1528558897,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528554413,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 17:41:41.934 +03:00 [DBG] Creating userinfo response
2018-06-09 17:41:41.936 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:41:41.938 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:41:41.948 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:41:41.952 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 17:41:41.955 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:41:41.963 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:41:41.973 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 17:41:41.976 +03:00 [DBG] End userinfo request
2018-06-09 17:46:38.390 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:46:38.395 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:46:38.398 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 17:46:38.402 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 17:46:38.406 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 17:46:38.409 +03:00 [DBG] Start authorize request
2018-06-09 17:46:38.412 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:46:38.415 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 17:46:38.483 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:46:38.486 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.71276083942138361528555598378",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 17:46:38.492 +03:00 [ERR] Request validation failed
2018-06-09 17:46:38.495 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.71276083942138361528555598378",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 17:46:38.503 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEE1ULCQ8F8:00000001",
  "TimeStamp": "2018-06-09T14:46:38Z",
  "ProcessId": 52232,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 17:46:38.517 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:46:38.521 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:47:16.459 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:47:16.462 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:47:16.466 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 17:47:16.469 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 17:47:16.476 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 17:47:16.480 +03:00 [DBG] Start authorize request
2018-06-09 17:47:16.482 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:47:16.486 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 17:47:16.517 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:47:16.531 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:47:16.633 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:47:16.643 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:47:16.660 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:47:16.664 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 17:47:16.668 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.23190925933763331528555636251",
  "SessionId": "2cf7fc929e52369f7b7c6f77b012932b",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.23190925933763331528555636251",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 17:47:16.692 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 17:47:16.702 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 17:47:16.705 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 17:47:16.708 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 17:47:16.711 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:47:16.732 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 17:47:16.752 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****-91A"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****8lbw"
    }
  ],
  "ActivityId": "0HLEE1ULCQ8F8:00000003",
  "TimeStamp": "2018-06-09T14:47:16Z",
  "ProcessId": 52232,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 17:47:16.759 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 17:47:48.056 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 17:47:48.137 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 17:47:48.143 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 17:47:48.151 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 17:47:48.168 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 17:47:48.207 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 17:47:48.250 +03:00 [DBG] Start key discovery request
2018-06-09 17:48:22.820 +03:00 [INF] Clearing 0 tokens
2018-06-09 17:48:47.394 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:48:47.399 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:48:47.403 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 17:48:47.407 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 17:48:47.410 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 17:48:47.414 +03:00 [DBG] Start authorize request
2018-06-09 17:48:47.418 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:48:47.425 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 17:48:47.501 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:48:47.518 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:48:47.641 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:48:47.653 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:48:47.837 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:48:47.841 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 17:48:47.844 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.97593630727406431528555727386",
  "SessionId": "2cf7fc929e52369f7b7c6f77b012932b",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.97593630727406431528555727386",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 17:48:47.873 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 17:48:47.884 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 17:48:47.886 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 17:48:47.888 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 17:48:47.891 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:48:47.912 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 17:48:47.948 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****v6gg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****ILZA"
    }
  ],
  "ActivityId": "0HLEE1ULCQ8F8:00000004",
  "TimeStamp": "2018-06-09T14:48:47Z",
  "ProcessId": 52232,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 17:48:47.955 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 17:48:50.667 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 17:48:50.679 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 17:48:50.683 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 17:48:50.691 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 17:48:50.695 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 17:48:50.699 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 17:48:50.702 +03:00 [DBG] Start key discovery request
2018-06-09 17:48:50.977 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 17:48:50.996 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 17:48:51.000 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 17:48:51.006 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 17:48:51.011 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 17:48:51.016 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 17:48:51.019 +03:00 [DBG] Start userinfo request
2018-06-09 17:48:51.029 +03:00 [DBG] Bearer token found in header
2018-06-09 17:48:51.084 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:48:51.113 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:48:51.124 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 17:48:51.128 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528555727,
    "exp": 1528559327,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528554413,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 17:48:51.133 +03:00 [DBG] Creating userinfo response
2018-06-09 17:48:51.135 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:48:51.138 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:48:51.154 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:48:51.157 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 17:48:51.159 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:48:51.169 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:48:51.190 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 17:48:51.194 +03:00 [DBG] End userinfo request
2018-06-09 17:53:52.460 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:53:52.468 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:53:52.542 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 17:53:52.547 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 17:53:52.578 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 17:53:52.584 +03:00 [DBG] Start authorize request
2018-06-09 17:53:52.587 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:53:52.590 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 17:53:52.649 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:53:52.663 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:53:52.765 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:53:52.783 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:53:52.851 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:53:52.856 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 17:53:52.860 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.28758791574088541528556032404",
  "SessionId": "2cf7fc929e52369f7b7c6f77b012932b",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.28758791574088541528556032404",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 17:53:52.895 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 17:53:52.904 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 17:53:52.908 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 17:53:52.911 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 17:53:52.913 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:53:52.937 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 17:53:52.951 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****Qynw"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****NeNA"
    }
  ],
  "ActivityId": "0HLEE1ULCQ8FJ:00000001",
  "TimeStamp": "2018-06-09T14:53:52Z",
  "ProcessId": 52232,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 17:53:52.955 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 17:53:54.825 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 17:53:54.838 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 17:53:54.842 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 17:53:54.849 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 17:53:54.853 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 17:53:54.856 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 17:53:54.860 +03:00 [DBG] Start key discovery request
2018-06-09 17:53:54.991 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 17:53:55.006 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 17:53:55.010 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 17:53:55.017 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 17:53:55.021 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 17:53:55.023 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 17:53:55.027 +03:00 [DBG] Start userinfo request
2018-06-09 17:53:55.032 +03:00 [DBG] Bearer token found in header
2018-06-09 17:53:55.067 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:53:55.098 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:53:55.109 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 17:53:55.112 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528556032,
    "exp": 1528559632,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528554413,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 17:53:55.117 +03:00 [DBG] Creating userinfo response
2018-06-09 17:53:55.122 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:53:55.124 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:53:55.134 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:53:55.137 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 17:53:55.141 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:53:55.151 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:53:55.163 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 17:53:55.166 +03:00 [DBG] End userinfo request
2018-06-09 17:58:54.362 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:58:54.369 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:58:54.374 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 17:58:54.383 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 17:58:54.388 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 17:58:54.393 +03:00 [DBG] Start authorize request
2018-06-09 17:58:54.397 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:58:54.401 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 17:58:54.471 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:58:54.474 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.460360861617226341528556334213",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 17:58:54.478 +03:00 [ERR] Request validation failed
2018-06-09 17:58:54.481 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.460360861617226341528556334213",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 17:58:54.485 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEE1ULCQ8FN:00000001",
  "TimeStamp": "2018-06-09T14:58:54Z",
  "ProcessId": 52232,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 17:58:54.499 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:58:54.503 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:59:29.959 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:59:29.963 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 17:59:29.966 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 17:59:29.969 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 17:59:29.972 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 17:59:29.980 +03:00 [DBG] Start authorize request
2018-06-09 17:59:29.982 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:59:29.986 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 17:59:30.016 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:59:30.029 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:59:30.157 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:59:30.169 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:59:30.189 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 17:59:30.195 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 17:59:30.199 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.272778166219511231528556369721",
  "SessionId": "2cf7fc929e52369f7b7c6f77b012932b",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.272778166219511231528556369721",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 17:59:30.228 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 17:59:30.237 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 17:59:30.240 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 17:59:30.245 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 17:59:30.247 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 17:59:30.262 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 17:59:30.282 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****coig"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****H5rw"
    }
  ],
  "ActivityId": "0HLEE1ULCQ8FN:00000003",
  "TimeStamp": "2018-06-09T14:59:30Z",
  "ProcessId": 52232,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 17:59:30.287 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 17:59:33.619 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 17:59:33.636 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 17:59:33.642 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 17:59:33.650 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 17:59:33.655 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 17:59:33.660 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 17:59:33.664 +03:00 [DBG] Start key discovery request
2018-06-09 17:59:34.045 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 17:59:34.063 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 17:59:34.067 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 17:59:34.075 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 17:59:34.083 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 17:59:34.088 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 17:59:34.094 +03:00 [DBG] Start userinfo request
2018-06-09 17:59:34.099 +03:00 [DBG] Bearer token found in header
2018-06-09 17:59:34.147 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:59:34.198 +03:00 [DBG] dews.web found in database: true
2018-06-09 17:59:34.215 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 17:59:34.218 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528556370,
    "exp": 1528559970,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528554413,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 17:59:34.230 +03:00 [DBG] Creating userinfo response
2018-06-09 17:59:34.235 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:59:34.239 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:59:34.250 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:59:34.254 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 17:59:34.259 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 17:59:34.268 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 17:59:34.281 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 17:59:34.285 +03:00 [DBG] End userinfo request
2018-06-09 18:04:37.977 +03:00 [WRN] No XML encryptor configured. Key "d99d5df6-6a38-42b1-965c-c5818ab5074e" may be persisted to storage in unencrypted form.
2018-06-09 18:04:38.332 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-09 18:04:38.346 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-09 18:04:38.348 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-09 18:04:38.352 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-09 18:04:38.355 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-09 18:04:38.638 +03:00 [DBG] Starting token cleanup
2018-06-09 18:04:40.214 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:04:40.259 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:16.985 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-09 18:05:17.002 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-09 18:05:17.006 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-09 18:05:17.014 +03:00 [DBG] Start discovery request
2018-06-09 18:05:18.310 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-09 18:05:18.706 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 18:05:18.710 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 18:05:18.713 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 18:05:18.723 +03:00 [DBG] Start key discovery request
2018-06-09 18:05:29.211 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:29.217 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:29.220 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 18:05:29.229 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 18:05:29.232 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 18:05:29.241 +03:00 [DBG] Start authorize request
2018-06-09 18:05:29.253 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:29.266 +03:00 [DBG] No user present in authorize request
2018-06-09 18:05:29.276 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 18:05:29.748 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:05:29.811 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:05:29.975 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:05:30.002 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:05:30.021 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:05:30.036 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 18:05:30.062 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.72171281244974411528556729196",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.72171281244974411528556729196",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 18:05:30.081 +03:00 [INF] Showing login: User is not authenticated
2018-06-09 18:05:30.108 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:30.112 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:30.210 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:30.214 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 18:05:30.251 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:05:30.262 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:05:30.283 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:05:30.295 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:05:30.319 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:05:30.323 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 18:05:30.359 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:05:31.112 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {643a5f85-bcc2-417b-9794-837042094774} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-09 18:05:32.560 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:32.565 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:32.598 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-09 18:05:37.225 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-09 18:05:37.247 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:37.252 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:37.273 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-09 18:05:37.647 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEE3994QNG1:00000006",
  "TimeStamp": "2018-06-09T15:05:37Z",
  "ProcessId": 59620,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 18:05:37.677 +03:00 [DBG] Augmenting SignInContext
2018-06-09 18:05:37.683 +03:00 [DBG] Adding amr claim with value: external
2018-06-09 18:05:37.690 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:05:37.697 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-09 18:05:37.708 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-09 18:05:37.731 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:05:37.738 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:05:37.742 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-09 18:05:37.747 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-09 18:05:37.751 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-09 18:05:37.764 +03:00 [DBG] Start authorize callback request
2018-06-09 18:05:37.774 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 18:05:37.778 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 18:05:37.820 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:05:37.831 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:05:37.856 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:05:37.870 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:05:37.900 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:05:37.904 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 18:05:37.908 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.72171281244974411528556729196",
  "SessionId": "e228753a88d2ad0dce595b5a8d602e7e",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.72171281244974411528556729196",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 18:05:38.017 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 18:05:38.042 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 18:05:38.056 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 18:05:38.080 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 18:05:38.087 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 18:05:38.204 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 18:05:38.288 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****G7Cg"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****WhSw"
    }
  ],
  "ActivityId": "0HLEE3994QNG1:00000007",
  "TimeStamp": "2018-06-09T15:05:38Z",
  "ProcessId": 59620,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 18:05:38.305 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 18:05:38.334 +03:00 [DBG] Augmenting SignInContext
2018-06-09 18:05:38.338 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-09 18:05:41.097 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 18:05:41.124 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 18:05:41.128 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 18:05:41.134 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 18:05:41.138 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 18:05:41.141 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 18:05:41.144 +03:00 [DBG] Start key discovery request
2018-06-09 18:05:41.439 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 18:05:41.457 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 18:05:41.460 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 18:05:41.468 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 18:05:41.476 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 18:05:41.479 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 18:05:41.490 +03:00 [DBG] Start userinfo request
2018-06-09 18:05:41.497 +03:00 [DBG] Bearer token found in header
2018-06-09 18:05:41.597 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:05:41.634 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:05:41.646 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 18:05:41.655 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528556738,
    "exp": 1528560338,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528556737,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 18:05:41.668 +03:00 [DBG] Creating userinfo response
2018-06-09 18:05:41.675 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:05:41.682 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:05:41.696 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:05:41.701 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 18:05:41.704 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:05:41.715 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:05:41.728 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 18:05:41.732 +03:00 [DBG] End userinfo request
2018-06-09 18:09:06.075 +03:00 [WRN] No XML encryptor configured. Key "b1243340-d122-407a-a23e-17c0c597781d" may be persisted to storage in unencrypted form.
2018-06-09 18:09:06.441 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-09 18:09:06.455 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-09 18:09:06.457 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-09 18:09:06.460 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-09 18:09:06.462 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-09 18:09:06.734 +03:00 [DBG] Starting token cleanup
2018-06-09 18:09:08.427 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:09:08.472 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:09:34.368 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-09 18:09:34.382 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-09 18:09:34.385 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-09 18:09:34.394 +03:00 [DBG] Start discovery request
2018-06-09 18:09:36.315 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-09 18:09:36.793 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 18:09:36.798 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 18:09:36.801 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 18:09:36.808 +03:00 [DBG] Start key discovery request
2018-06-09 18:10:40.849 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:10:40.854 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:10:40.858 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 18:10:40.865 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 18:10:40.869 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 18:10:40.878 +03:00 [DBG] Start authorize request
2018-06-09 18:10:40.885 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:10:40.896 +03:00 [DBG] No user present in authorize request
2018-06-09 18:10:40.908 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 18:10:41.564 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:10:41.597 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.76224130855641971528557040842",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 18:10:41.609 +03:00 [ERR] Request validation failed
2018-06-09 18:10:41.614 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.76224130855641971528557040842",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 18:10:41.694 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEE3BP41FP9:00000002",
  "TimeStamp": "2018-06-09T15:10:41Z",
  "ProcessId": 23668,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 18:10:41.728 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:10:41.732 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:18:12.559 +03:00 [WRN] No XML encryptor configured. Key "711c49ac-9f86-4878-a711-0905644efb79" may be persisted to storage in unencrypted form.
2018-06-09 18:18:12.997 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-09 18:18:13.011 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-09 18:18:13.022 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-09 18:18:13.026 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-09 18:18:13.031 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-09 18:18:13.346 +03:00 [DBG] Starting token cleanup
2018-06-09 18:18:14.811 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:18:14.860 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:08.117 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:08.142 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:08.184 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 18:22:08.224 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 18:22:08.229 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 18:22:08.239 +03:00 [DBG] Start authorize request
2018-06-09 18:22:08.249 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:08.258 +03:00 [DBG] No user present in authorize request
2018-06-09 18:22:08.277 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 18:22:09.961 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:22:10.077 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:22:10.435 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:22:10.467 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:22:10.487 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:22:10.503 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 18:22:10.591 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.81299406491813581528557728098",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.81299406491813581528557728098",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 18:22:10.608 +03:00 [INF] Showing login: User is not authenticated
2018-06-09 18:22:10.628 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:10.632 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:10.732 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:10.736 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 18:22:10.778 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:22:10.789 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:22:10.813 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:22:10.823 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:22:10.844 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:22:10.849 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 18:22:10.903 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:22:11.653 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {d99d5df6-6a38-42b1-965c-c5818ab5074e} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-09 18:22:13.358 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:13.366 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:13.396 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-09 18:22:18.769 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-09 18:22:18.782 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:18.786 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:18.802 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-09 18:22:19.126 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEE3GRT01MI:00000006",
  "TimeStamp": "2018-06-09T15:22:19Z",
  "ProcessId": 73608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 18:22:19.148 +03:00 [DBG] Augmenting SignInContext
2018-06-09 18:22:19.154 +03:00 [DBG] Adding amr claim with value: external
2018-06-09 18:22:19.160 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 18:22:19.169 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-09 18:22:19.178 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-09 18:22:19.201 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:22:19.207 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:22:19.210 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-09 18:22:19.215 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-09 18:22:19.219 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-09 18:22:19.229 +03:00 [DBG] Start authorize callback request
2018-06-09 18:22:19.240 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 18:22:19.243 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 18:22:19.292 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:22:19.303 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:22:19.325 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:22:19.337 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:22:19.361 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:22:19.365 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 18:22:19.368 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.81299406491813581528557728098",
  "SessionId": "abf7a1886691cd50f92c5fac6e1b5f61",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.81299406491813581528557728098",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 18:22:19.486 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 18:22:19.516 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 18:22:19.530 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 18:22:19.549 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 18:22:19.554 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 18:22:19.670 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 18:22:19.727 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****T2ow"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****tYmg"
    }
  ],
  "ActivityId": "0HLEE3GRT01MI:00000007",
  "TimeStamp": "2018-06-09T15:22:19Z",
  "ProcessId": 73608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 18:22:19.743 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 18:22:19.776 +03:00 [DBG] Augmenting SignInContext
2018-06-09 18:22:19.779 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-09 18:22:22.491 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 18:22:22.518 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 18:22:22.522 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 18:22:22.530 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 18:22:22.537 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 18:22:22.540 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 18:22:22.547 +03:00 [DBG] Start key discovery request
2018-06-09 18:22:22.813 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 18:22:22.826 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 18:22:22.830 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 18:22:22.838 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 18:22:22.844 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 18:22:22.848 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 18:22:22.863 +03:00 [DBG] Start userinfo request
2018-06-09 18:22:22.873 +03:00 [DBG] Bearer token found in header
2018-06-09 18:22:23.000 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:22:23.038 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:22:23.055 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 18:22:23.068 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528557739,
    "exp": 1528561339,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528557739,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 18:22:23.080 +03:00 [DBG] Creating userinfo response
2018-06-09 18:22:23.088 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:22:23.095 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:22:23.109 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:22:23.113 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 18:22:23.117 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:22:23.129 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:22:23.152 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 18:22:23.157 +03:00 [DBG] End userinfo request
2018-06-09 18:22:24.708 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-09 18:22:24.714 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-09 18:22:24.720 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-09 18:22:24.728 +03:00 [DBG] Start discovery request
2018-06-09 18:22:24.855 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-09 18:22:25.025 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 18:22:25.028 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 18:22:25.037 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 18:22:25.043 +03:00 [DBG] Start key discovery request
2018-06-09 18:27:53.474 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:27:53.480 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:27:53.484 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 18:27:53.501 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 18:27:53.511 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 18:27:53.521 +03:00 [DBG] Start authorize request
2018-06-09 18:27:53.528 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 18:27:53.533 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 18:27:53.606 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:27:53.622 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:27:53.714 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:27:53.725 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:27:53.744 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:27:53.748 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 18:27:53.751 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.75266694037115411528558073334",
  "SessionId": "abf7a1886691cd50f92c5fac6e1b5f61",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.75266694037115411528558073334",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 18:27:53.773 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 18:27:53.781 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 18:27:53.784 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 18:27:53.787 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 18:27:53.792 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 18:27:53.811 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 18:27:53.836 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****9hlQ"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****nVHw"
    }
  ],
  "ActivityId": "0HLEE3GRT01MO:00000001",
  "TimeStamp": "2018-06-09T15:27:53Z",
  "ProcessId": 73608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 18:27:53.846 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 18:27:55.677 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 18:27:55.691 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 18:27:55.696 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 18:27:55.702 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 18:27:55.706 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 18:27:55.709 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 18:27:55.712 +03:00 [DBG] Start key discovery request
2018-06-09 18:27:55.922 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 18:27:55.933 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 18:27:55.936 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 18:27:55.941 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 18:27:55.945 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 18:27:55.950 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 18:27:55.958 +03:00 [DBG] Start userinfo request
2018-06-09 18:27:55.961 +03:00 [DBG] Bearer token found in header
2018-06-09 18:27:56.000 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:27:56.031 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:27:56.050 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 18:27:56.054 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528558073,
    "exp": 1528561673,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528557739,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 18:27:56.058 +03:00 [DBG] Creating userinfo response
2018-06-09 18:27:56.061 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:27:56.064 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:27:56.076 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:27:56.079 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 18:27:56.082 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:27:56.095 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:27:56.108 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 18:27:56.112 +03:00 [DBG] End userinfo request
2018-06-09 18:32:55.254 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:32:55.266 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:32:55.279 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 18:32:55.296 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 18:32:55.307 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 18:32:55.322 +03:00 [DBG] Start authorize request
2018-06-09 18:32:55.339 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 18:32:55.351 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 18:32:55.425 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:32:55.428 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.96816931143703691528558375228",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 18:32:55.435 +03:00 [ERR] Request validation failed
2018-06-09 18:32:55.439 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.96816931143703691528558375228",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 18:32:55.452 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEE3GRT01MS:00000001",
  "TimeStamp": "2018-06-09T15:32:55Z",
  "ProcessId": 73608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 18:32:55.480 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:32:55.483 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:46:13.629 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 18:46:13.645 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 18:46:13.648 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 18:46:13.654 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 18:46:13.657 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 18:46:13.660 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 18:46:13.663 +03:00 [DBG] Start key discovery request
2018-06-09 18:46:42.475 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:46:42.478 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:46:42.481 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 18:46:42.486 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 18:46:42.488 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 18:46:42.491 +03:00 [DBG] Start authorize request
2018-06-09 18:46:42.493 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 18:46:42.496 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 18:46:42.559 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:46:42.577 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:46:42.686 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:46:42.695 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:46:42.713 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 18:46:42.717 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 18:46:42.719 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.68546343292638331528559202456",
  "SessionId": "abf7a1886691cd50f92c5fac6e1b5f61",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.68546343292638331528559202456",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 18:46:42.738 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 18:46:42.746 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 18:46:42.749 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 18:46:42.752 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 18:46:42.754 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 18:46:42.780 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 18:46:42.796 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****onRA"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****JsZg"
    }
  ],
  "ActivityId": "0HLEE3GRT01MV:00000001",
  "TimeStamp": "2018-06-09T15:46:42Z",
  "ProcessId": 73608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 18:46:42.804 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 18:46:45.527 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 18:46:45.541 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 18:46:45.545 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 18:46:45.553 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 18:46:45.556 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 18:46:45.560 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 18:46:45.563 +03:00 [DBG] Start key discovery request
2018-06-09 18:46:45.815 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 18:46:45.827 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 18:46:45.830 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 18:46:45.837 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 18:46:45.842 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 18:46:45.844 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 18:46:45.855 +03:00 [DBG] Start userinfo request
2018-06-09 18:46:45.858 +03:00 [DBG] Bearer token found in header
2018-06-09 18:46:45.890 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:46:45.918 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:46:45.926 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 18:46:45.928 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528559202,
    "exp": 1528562802,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528557739,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 18:46:45.933 +03:00 [DBG] Creating userinfo response
2018-06-09 18:46:45.935 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:46:45.938 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:46:45.946 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:46:45.949 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 18:46:45.952 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 18:46:45.959 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 18:46:45.973 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 18:46:45.976 +03:00 [DBG] End userinfo request
2018-06-09 18:51:43.232 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:51:43.235 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:51:43.238 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 18:51:43.243 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 18:51:43.246 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 18:51:43.248 +03:00 [DBG] Start authorize request
2018-06-09 18:51:43.251 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 18:51:43.253 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 18:51:43.317 +03:00 [DBG] dews.web found in database: true
2018-06-09 18:51:43.322 +03:00 [ERR] Invalid redirect_uri: https://localhost:44311
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.33261449096944151528559503215",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 18:51:43.330 +03:00 [ERR] Request validation failed
2018-06-09 18:51:43.335 +03:00 [INF] {
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "RequestedScopes": "",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "https://localhost:44311",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.33261449096944151528559503215",
    "state": "15285513154110.766302739303111",
    "prompt": "none"
  }
}
2018-06-09 18:51:43.340 +03:00 [INF] {
  "Name": "Token Issued Failure",
  "Category": "Token",
  "EventType": "Failure",
  "Id": 2001,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "",
  "Error": "unauthorized_client",
  "ErrorDescription": "Invalid redirect_uri",
  "ActivityId": "0HLEE3GRT01N2:00000001",
  "TimeStamp": "2018-06-09T15:51:43Z",
  "ProcessId": 73608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 18:51:43.352 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 18:51:43.386 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 19:08:04.666 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 19:08:04.670 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 19:08:04.676 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 19:08:04.679 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 19:08:04.682 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 19:08:04.685 +03:00 [DBG] Start authorize request
2018-06-09 19:08:04.688 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 19:08:04.698 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 19:08:04.766 +03:00 [DBG] dews.web found in database: true
2018-06-09 19:08:04.780 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:08:04.893 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 19:08:04.902 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:08:04.932 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 19:08:04.935 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 19:08:04.937 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285604845930.9811778627309449",
  "Nonce": "N0.58046254728367291528560484593",
  "SessionId": "abf7a1886691cd50f92c5fac6e1b5f61",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.58046254728367291528560484593",
    "state": "15285604845930.9811778627309449"
  }
}
2018-06-09 19:08:04.949 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 19:08:04.960 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 19:08:04.963 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 19:08:04.965 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 19:08:04.967 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 19:08:04.983 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 19:08:04.998 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****KXrQ"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****747Q"
    }
  ],
  "ActivityId": "0HLEE3GRT01N4:00000001",
  "TimeStamp": "2018-06-09T16:08:04Z",
  "ProcessId": 73608,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 19:08:05.002 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285604845930.9811778627309449",
  "Scope": "openid profile dews.api"
}
2018-06-09 19:08:08.218 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 19:08:08.229 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 19:08:08.233 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 19:08:08.240 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 19:08:08.243 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 19:08:08.246 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 19:08:08.250 +03:00 [DBG] Start key discovery request
2018-06-09 19:08:08.548 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 19:08:08.594 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 19:08:08.601 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 19:08:08.613 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 19:08:08.617 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 19:08:08.623 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 19:08:08.627 +03:00 [DBG] Start userinfo request
2018-06-09 19:08:08.631 +03:00 [DBG] Bearer token found in header
2018-06-09 19:08:08.684 +03:00 [DBG] dews.web found in database: true
2018-06-09 19:08:08.719 +03:00 [DBG] dews.web found in database: true
2018-06-09 19:08:08.729 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 19:08:08.731 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528560484,
    "exp": 1528564084,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528557739,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 19:08:08.735 +03:00 [DBG] Creating userinfo response
2018-06-09 19:08:08.741 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 19:08:08.743 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 19:08:08.750 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:08:08.753 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 19:08:08.756 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 19:08:08.763 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:08:08.782 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 19:08:08.784 +03:00 [DBG] End userinfo request
2018-06-09 19:14:32.683 +03:00 [WRN] No XML encryptor configured. Key "1a318a08-f0ec-4fb7-bf5e-6552a24db9a2" may be persisted to storage in unencrypted form.
2018-06-09 19:14:33.072 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-09 19:14:33.083 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-09 19:14:33.086 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-09 19:14:33.090 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-09 19:14:33.093 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-09 19:14:33.407 +03:00 [DBG] Starting token cleanup
2018-06-09 19:14:35.001 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:14:35.060 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:14:54.973 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:14:54.979 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:14:54.992 +03:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-06-09 19:14:55.008 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-06-09 19:14:55.012 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-06-09 19:14:55.025 +03:00 [DBG] Start authorize request
2018-06-09 19:14:55.034 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:14:55.046 +03:00 [DBG] No user present in authorize request
2018-06-09 19:14:55.065 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 19:14:56.769 +03:00 [DBG] dews.web found in database: true
2018-06-09 19:14:56.874 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:14:57.274 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 19:14:57.310 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:14:57.333 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 19:14:57.353 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 19:14:57.495 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "anonymous",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.27559878142096171528560894958",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.27559878142096171528560894958",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 19:14:57.524 +03:00 [INF] Showing login: User is not authenticated
2018-06-09 19:14:57.549 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:14:57.558 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:14:57.715 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:14:57.723 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 19:14:57.772 +03:00 [DBG] dews.web found in database: true
2018-06-09 19:14:57.780 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:14:57.806 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 19:14:57.817 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:14:57.849 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 19:14:57.857 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 19:14:57.895 +03:00 [DBG] dews.web found in database: true
2018-06-09 19:14:58.947 +03:00 [ERR] An exception was thrown while deserializing the token.
System.InvalidOperationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {711c49ac-9f86-4878-a711-0905644efb79} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2018-06-09 19:15:00.538 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:15:00.545 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:15:00.580 +03:00 [INF] AuthenticationScheme: Google was challenged.
2018-06-09 19:15:05.667 +03:00 [INF] AuthenticationScheme: Identity.External signed in.
2018-06-09 19:15:05.691 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:15:05.700 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:15:05.726 +03:00 [INF] AuthenticationScheme: Identity.External was successfully authenticated.
2018-06-09 19:15:06.092 +03:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Provider": "Google",
  "ProviderUserId": "114587808670829409165",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "DisplayName": "MURAT AKKAÅž",
  "Endpoint": "UI",
  "ActivityId": "0HLEE4GB7Q1HL:00000006",
  "TimeStamp": "2018-06-09T16:15:06Z",
  "ProcessId": 83444,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 19:15:06.114 +03:00 [DBG] Augmenting SignInContext
2018-06-09 19:15:06.119 +03:00 [DBG] Adding amr claim with value: external
2018-06-09 19:15:06.125 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:15:06.134 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-09 19:15:06.148 +03:00 [INF] AuthenticationScheme: Identity.External signed out.
2018-06-09 19:15:06.188 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 19:15:06.192 +03:00 [INF] AuthenticationScheme: Identity.Application was successfully authenticated.
2018-06-09 19:15:06.198 +03:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2018-06-09 19:15:06.203 +03:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2018-06-09 19:15:06.205 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2018-06-09 19:15:06.220 +03:00 [DBG] Start authorize callback request
2018-06-09 19:15:06.231 +03:00 [DBG] User in authorize request: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 19:15:06.234 +03:00 [DBG] Start authorize request protocol validation
2018-06-09 19:15:06.268 +03:00 [DBG] dews.web found in database: true
2018-06-09 19:15:06.276 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:15:06.296 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 19:15:06.306 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:15:06.323 +03:00 [DBG] Found ["dews.api"] API scopes in database
2018-06-09 19:15:06.327 +03:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-06-09 19:15:06.333 +03:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "AllowedRedirectUris": [
    "http://localhost:4200"
  ],
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ResponseType": "id_token token",
  "ResponseMode": "fragment",
  "GrantType": "implicit",
  "RequestedScopes": "openid profile dews.api",
  "State": "15285513154110.766302739303111",
  "Nonce": "N0.27559878142096171528560894958",
  "SessionId": "2f3c82fd6ce59fff222adfe2eaf8e1f7",
  "Raw": {
    "client_id": "dews.web",
    "redirect_uri": "http://localhost:4200",
    "response_type": "id_token token",
    "scope": "openid profile dews.api",
    "nonce": "N0.27559878142096171528560894958",
    "state": "15285513154110.766302739303111"
  }
}
2018-06-09 19:15:06.468 +03:00 [DBG] FiqbWCxYhGZWkSXtq22OFuodaqKatYAw7lFad/7ddG4= found in database: true
2018-06-09 19:15:06.501 +03:00 [DBG] Consent found in consent store is same as current request, consent is not required
2018-06-09 19:15:06.516 +03:00 [DBG] Creating Implicit Flow response.
2018-06-09 19:15:06.533 +03:00 [DBG] Getting claims for access token for client: dews.web
2018-06-09 19:15:06.537 +03:00 [DBG] Getting claims for access token for subject: c5e370e6-7218-49d8-a520-987e63697d43
2018-06-09 19:15:06.672 +03:00 [DBG] Getting claims for identity token for subject: c5e370e6-7218-49d8-a520-987e63697d43 and client: dews.web
2018-06-09 19:15:06.719 +03:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "dews.web",
  "ClientName": "Developer News",
  "RedirectUri": "http://localhost:4200",
  "Endpoint": "Authorize",
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "Scopes": "openid profile dews.api",
  "GrantType": "implicit",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****gCHw"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****Pgkg"
    }
  ],
  "ActivityId": "0HLEE4GB7Q1HL:00000007",
  "TimeStamp": "2018-06-09T16:15:06Z",
  "ProcessId": 83444,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-06-09 19:15:06.736 +03:00 [INF] Authorize endpoint response
{
  "SubjectId": "c5e370e6-7218-49d8-a520-987e63697d43",
  "ClientId": "dews.web",
  "RedirectUri": "http://localhost:4200",
  "State": "15285513154110.766302739303111",
  "Scope": "openid profile dews.api"
}
2018-06-09 19:15:06.775 +03:00 [DBG] Augmenting SignInContext
2018-06-09 19:15:06.781 +03:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-06-09 19:15:10.035 +03:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2018-06-09 19:15:10.067 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 19:15:10.071 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 19:15:10.079 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 19:15:10.087 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 19:15:10.091 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 19:15:10.103 +03:00 [DBG] Start key discovery request
2018-06-09 19:15:10.431 +03:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2018-06-09 19:15:10.450 +03:00 [DBG] Origin http://localhost:4200 is allowed: true
2018-06-09 19:15:10.460 +03:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2018-06-09 19:15:10.468 +03:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-06-09 19:15:10.479 +03:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-06-09 19:15:10.483 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-06-09 19:15:10.499 +03:00 [DBG] Start userinfo request
2018-06-09 19:15:10.512 +03:00 [DBG] Bearer token found in header
2018-06-09 19:15:10.627 +03:00 [DBG] dews.web found in database: true
2018-06-09 19:15:10.666 +03:00 [DBG] dews.web found in database: true
2018-06-09 19:15:10.691 +03:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-06-09 19:15:10.704 +03:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1528560906,
    "exp": 1528564506,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "dews.api"
    ],
    "client_id": "dews.web",
    "sub": "c5e370e6-7218-49d8-a520-987e63697d43",
    "auth_time": 1528560906,
    "idp": "Google",
    "scope": [
      "openid",
      "profile",
      "dews.api"
    ],
    "amr": "external"
  }
}
2018-06-09 19:15:10.722 +03:00 [DBG] Creating userinfo response
2018-06-09 19:15:10.733 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 19:15:10.747 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 19:15:10.763 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:15:10.770 +03:00 [DBG] Requested claim types: sub updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name
2018-06-09 19:15:10.778 +03:00 [DBG] Scopes in access token: openid profile dews.api
2018-06-09 19:15:10.800 +03:00 [DBG] Found ["openid","profile"] identity scopes in database
2018-06-09 19:15:10.816 +03:00 [INF] Profile service returned to the following claim types: sub name preferred_username
2018-06-09 19:15:10.820 +03:00 [DBG] End userinfo request
2018-06-09 19:15:14.192 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-09 19:15:14.197 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-09 19:15:14.199 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-09 19:15:14.212 +03:00 [DBG] Start discovery request
2018-06-09 19:15:14.364 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-09 19:15:14.558 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 19:15:14.561 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 19:15:14.565 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 19:15:14.567 +03:00 [DBG] Start key discovery request
2018-06-09 19:17:01.794 +03:00 [WRN] No XML encryptor configured. Key "4964bfd7-4cd4-4f09-a5cb-4d9caf2a5fac" may be persisted to storage in unencrypted form.
2018-06-09 19:17:02.191 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-09 19:17:02.203 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-09 19:17:02.206 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-09 19:17:02.209 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-09 19:17:02.213 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-09 19:17:02.492 +03:00 [DBG] Starting token cleanup
2018-06-09 19:17:04.094 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:17:04.141 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 19:17:24.160 +03:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-06-09 19:17:24.174 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-06-09 19:17:24.178 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-06-09 19:17:24.190 +03:00 [DBG] Start discovery request
2018-06-09 19:17:25.639 +03:00 [DBG] Found ["openid","profile","email","custom.profile","dews.api"] as all scopes in database
2018-06-09 19:17:26.120 +03:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-06-09 19:17:26.126 +03:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-06-09 19:17:26.131 +03:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-06-09 19:17:26.139 +03:00 [DBG] Start key discovery request
2018-06-09 20:03:38.785 +03:00 [WRN] No XML encryptor configured. Key "f66e338b-870b-4ce5-99ee-f5632b755cf3" may be persisted to storage in unencrypted form.
2018-06-09 20:03:39.207 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-09 20:03:39.218 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-09 20:03:39.220 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-09 20:03:39.223 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-09 20:03:39.226 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-09 20:03:39.464 +03:00 [DBG] Starting token cleanup
2018-06-09 20:03:41.135 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 20:03:41.196 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 20:19:44.043 +03:00 [WRN] No XML encryptor configured. Key "b006f03f-d074-47dc-83bd-068086d9c3bf" may be persisted to storage in unencrypted form.
2018-06-09 20:19:44.411 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-09 20:19:44.423 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-09 20:19:44.426 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-09 20:19:44.428 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-09 20:19:44.430 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-09 20:19:44.763 +03:00 [DBG] Starting token cleanup
2018-06-09 20:19:46.508 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 20:19:46.554 +03:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2018-06-09 21:26:52.898 +03:00 [WRN] No XML encryptor configured. Key "527b9a35-4f88-450b-9773-f5752f7d40a4" may be persisted to storage in unencrypted form.
2018-06-09 21:26:53.337 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-09 21:26:53.348 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-09 21:26:53.351 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-09 21:26:53.353 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-09 21:26:53.355 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-09 21:26:53.601 +03:00 [DBG] Starting token cleanup
2018-06-09 21:57:44.191 +03:00 [WRN] No XML encryptor configured. Key "e45d3130-00c1-4b03-9f06-9ed631d9dc65" may be persisted to storage in unencrypted form.
2018-06-09 21:57:44.470 +03:00 [DBG] Using Identity.Application as default scheme for authentication
2018-06-09 21:57:44.480 +03:00 [DBG] Using Identity.External as default scheme for sign-in
2018-06-09 21:57:44.483 +03:00 [DBG] Using Identity.External as default scheme for sign-out
2018-06-09 21:57:44.485 +03:00 [DBG] Using Identity.Application as default scheme for challenge
2018-06-09 21:57:44.487 +03:00 [DBG] Using Identity.Application as default scheme for forbid
2018-06-09 21:57:44.703 +03:00 [DBG] Starting token cleanup
2018-06-09 22:57:45.135 +03:00 [INF] Clearing 0 tokens
2018-06-09 23:57:45.268 +03:00 [INF] Clearing 0 tokens
